<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E7%9B%98%E5%8F%A4-security.html"><meta property="og:title" content="Feignæ¨¡å—"><meta property="og:description" content="Feignæ¨¡å— å¦‚ä½•ä½¿ç”¨ å¼•ç”¨å¦‚ä¸‹æ¨¡å— xml java java æ³¨è§£ä»‹ç» java æŠ€æœ¯åŸç† java java java java java java image.pngimage.png"><meta property="og:type" content="article"><meta property="og:image" content="http://pangu.kingtsoft.com/pangu-facade/assets/image1.8ca381d0.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-11-18T07:25:41.000Z"><meta property="article:author" content="Cotton Eye Joe"><meta property="article:modified_time" content="2024-11-18T07:25:41.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Feignæ¨¡å—","image":["http://pangu.kingtsoft.com/pangu-facade/assets/image1.8ca381d0.png"],"dateModified":"2024-11-18T07:25:41.000Z","author":[{"@type":"Person","name":"Cotton Eye Joe","url":"https://github.com/ToDreamr"}]}</script><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><script async src="https://umami.zhenxin.me/script.js" data-website-id="a799e189-cf7e-4f5a-ac98-71de364f3637"></script><script src="https://cdn.armoe.cn/static/js/autoGray.js"></script><title>Feignæ¨¡å—</title><meta name="description" content="Feignæ¨¡å— å¦‚ä½•ä½¿ç”¨ å¼•ç”¨å¦‚ä¸‹æ¨¡å— xml java java æ³¨è§£ä»‹ç» java æŠ€æœ¯åŸç† java java java java java java image.pngimage.png">
    <link rel="preload" href="/assets/style-DuvwdHTW.css" as="style"><link rel="stylesheet" href="/assets/style-DuvwdHTW.css">
    <link rel="modulepreload" href="/assets/app-TmqSDitQ.js"><link rel="modulepreload" href="/assets/ç›˜å¤-security.html-BNSYl7Ck.js">
    <link rel="prefetch" href="/assets/index.html-CFhogwoB.js" as="script"><link rel="prefetch" href="/assets/portfolio.html-BxVteSEA.js" as="script"><link rel="prefetch" href="/assets/å‹é“¾.html-C5Yy13PO.js" as="script"><link rel="prefetch" href="/assets/index.html-B984vThc.js" as="script"><link rel="prefetch" href="/assets/disable.html-C2YOeozI.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-DLwcfHs0.js" as="script"><link rel="prefetch" href="/assets/layout.html-B-ye_h4s.js" as="script"><link rel="prefetch" href="/assets/markdown.html-BznAMy0W.js" as="script"><link rel="prefetch" href="/assets/page.html-Cs21IQYM.js" as="script"><link rel="prefetch" href="/assets/å‹é“¾.html-raC_u1Wm.js" as="script"><link rel="prefetch" href="/assets/index.html-CpypAr2P.js" as="script"><link rel="prefetch" href="/assets/index.html-BrC_NUuz.js" as="script"><link rel="prefetch" href="/assets/Otome Games Analysis.html-DcTONphA.js" as="script"><link rel="prefetch" href="/assets/åœ¨ç”Ÿæ´»ä¸­çš„ä¸€äº›æ€è€ƒé—®é¢˜.html-BUJ4mZ8X.js" as="script"><link rel="prefetch" href="/assets/å­¦ä¹ è®¡åˆ’.html-DZv_pjah.js" as="script"><link rel="prefetch" href="/assets/Idea.html-DQvV8xX9.js" as="script"><link rel="prefetch" href="/assets/10æœˆ.html-lzGqs3d4.js" as="script"><link rel="prefetch" href="/assets/ä¾èµ–ç›¸å…³.html-CZmsW12S.js" as="script"><link rel="prefetch" href="/assets/word.html-chRMUopq.js" as="script"><link rel="prefetch" href="/assets/æ•°å­—é©¬åŠ›.html-OD4Jc7bm.js" as="script"><link rel="prefetch" href="/assets/7.0ç—…å†.html-Dj1nuK-0.js" as="script"><link rel="prefetch" href="/assets/Oracleæ•°æ®åº“éƒ¨åˆ†ä»£ç æµ‹è¯•ä¸é€šè¿‡.html-C98zucvH.js" as="script"><link rel="prefetch" href="/assets/SQLæ—¥å¿—æ’æŸ¥è®°å½•çš„å·¥ä½œæµç¨‹.html-CSZ0MjQG.js" as="script"><link rel="prefetch" href="/assets/kemerç—…å†éƒ¨æ¶æ„æ•´ç†.html-BgdKrD4g.js" as="script"><link rel="prefetch" href="/assets/äº‹åŠ¡åˆ†æ.html-CFwRrPzh.js" as="script"><link rel="prefetch" href="/assets/å¦‚ä½•åœ¨å·¥ä½œå½“ä¸­ä¹¦å†™éœ€è¦çš„SQL.html-B1pMuj5D.js" as="script"><link rel="prefetch" href="/assets/å·¥ä½œæµç¨‹.html-WyFbYxxi.js" as="script"><link rel="prefetch" href="/assets/å¼€å‘è§„èŒƒå’ŒçŸ¥è¯†æ–‡æ¡£.html-BoXJs-3h.js" as="script"><link rel="prefetch" href="/assets/å¼‚å¸¸SQLæ•°æ®æŸ¥è¯¢.html-EOtg5wiJ.js" as="script"><link rel="prefetch" href="/assets/è´¨æ§é¡¹-ä¿®æ”¹ä»£ç (SQL).html-Co5eAkUk.js" as="script"><link rel="prefetch" href="/assets/é‡‘å”è½¯ä»¶.html-CFjCXWJk.js" as="script"><link rel="prefetch" href="/assets/é‡‘å”è½¯ä»¶éƒ¨åˆ†ä»£ç åˆ†æ.html-_VLRBwED.js" as="script"><link rel="prefetch" href="/assets/Ubuntuç³»ç»Ÿå„è½¯ä»¶.html-C7JJkfHp.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ.html-Dw3KignD.js" as="script"><link rel="prefetch" href="/assets/ç—…å†-ä¸´åºŠéƒ¨é—¨åç«¯å®ä¹ .html-x8hHLZRr.js" as="script"><link rel="prefetch" href="/assets/é«˜å¹¶å‘ç¼–ç¨‹.html-B7Od-Dqf.js" as="script"><link rel="prefetch" href="/assets/JVMå†…å­˜æ¨¡å‹.html-str4ZJKB.js" as="script"><link rel="prefetch" href="/assets/å†…å­˜ç®¡ç†.html-DoI0DYYB.js" as="script"><link rel="prefetch" href="/assets/ç±»ä¸ç±»åŠ è½½.html-CkfoeH-m.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼ç³»åˆ— - è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™.html-IyVKPnsx.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼ç³»åˆ— - è®¾è®¡æ¨¡å¼ï¼ˆä¸‰ï¼‰ç»“æ„å‹.html-exR171fs.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼ç³»åˆ— - è®¾è®¡æ¨¡å¼ï¼ˆäºŒï¼‰åˆ›å»ºå‹.html-DotyHGhC.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼ç³»åˆ— - è®¾è®¡æ¨¡å¼ï¼ˆå››ï¼‰è¡Œä¸ºå‹.html-DuscxS-X.js" as="script"><link rel="prefetch" href="/assets/Cpp.html-DFcjkRw5.js" as="script"><link rel="prefetch" href="/assets/index.html-PmrsYTop.js" as="script"><link rel="prefetch" href="/assets/baz.html-B14OHDXJ.js" as="script"><link rel="prefetch" href="/assets/index.html-b0d1hDEY.js" as="script"><link rel="prefetch" href="/assets/ray.html-DyrNoDCi.js" as="script"><link rel="prefetch" href="/assets/KafKa.html-C0tddeAu.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ.html-BagOXJAw.js" as="script"><link rel="prefetch" href="/assets/Redis(æ¶ˆæ¯æ¨¡å¼).html-Bh1YjezP.js" as="script"><link rel="prefetch" href="/assets/Redis(ç›´è¿æ¨¡å¼).html-27s6hCSO.js" as="script"><link rel="prefetch" href="/assets/minio.html-15s3DzN0.js" as="script"><link rel="prefetch" href="/assets/mongodb.html-BHhz7rdB.js" as="script"><link rel="prefetch" href="/assets/nacosé›†æˆ.html-_W92HURR.js" as="script"><link rel="prefetch" href="/assets/ESæ¨¡å—.html-cVa8rfWs.js" as="script"><link rel="prefetch" href="/assets/Prometheusæ¨¡å—.html-B9zhv2Uq.js" as="script"><link rel="prefetch" href="/assets/shardingæ¨¡å—.html-CJ_2ctfS.js" as="script"><link rel="prefetch" href="/assets/åˆ†å¸ƒå¼äº‹åŠ¡ç³»åˆ—.html-Dam42lAJ.js" as="script"><link rel="prefetch" href="/assets/å¤šçº¿ç¨‹äº‹åŠ¡.html-BIk5SHPd.js" as="script"><link rel="prefetch" href="/assets/æ•°æ®æºæ¨¡å—.html-DasOVfAL.js" as="script"><link rel="prefetch" href="/assets/Httpsæ¨¡å—.html-CRqUledA.js" as="script"><link rel="prefetch" href="/assets/Mybatis-Plus.html-CFKMdE9l.js" as="script"><link rel="prefetch" href="/assets/SQLè·Ÿè¸ªæ¨¡å—.html-CIKqInmj.js" as="script"><link rel="prefetch" href="/assets/Swagger.html-BQPoX06B.js" as="script"><link rel="prefetch" href="/assets/chatæ¨¡å—.html-BSeu_aX2.js" as="script"><link rel="prefetch" href="/assets/listå·¥ä½œæµé›†æˆ.html-DIQStKHW.js" as="script"><link rel="prefetch" href="/assets/plugç»„ä»¶.html-CbuWvXTO.js" as="script"><link rel="prefetch" href="/assets/xxl-jobæ¨¡å—.html-BHQ0Jy0h.js" as="script"><link rel="prefetch" href="/assets/ä»“ç›’æ¨¡å—.html-BGVctQPy.js" as="script"><link rel="prefetch" href="/assets/å·¥å…·ç±».html-Cn1HrSJh.js" as="script"><link rel="prefetch" href="/assets/å»¶æ—¶æ¨¡å—.html-D2FsUmru.js" as="script"><link rel="prefetch" href="/assets/å¼‚å¸¸æ¨¡å—.html-DaD6rPvr.js" as="script"><link rel="prefetch" href="/assets/æ§åˆ¶å™¨æ’é™¤æ¨¡å—.html-o809dcAH.js" as="script"><link rel="prefetch" href="/assets/æ¡†æ¶æ—¥å¿—æ¨¡å—.html-Bkk0GlTK.js" as="script"><link rel="prefetch" href="/assets/ç›˜å¤.html-DERWeGkn.js" as="script"><link rel="prefetch" href="/assets/ç›˜å¤securityæ¨¡å—(å«æˆæƒ).html-CYFgg1E-.js" as="script"><link rel="prefetch" href="/assets/ç¼“å­˜æ¨¡å—.html-CdQ9R__H.js" as="script"><link rel="prefetch" href="/assets/è„±æ•å’ŒæŒä¹…å±‚åŠ è§£å¯†.html-DVQzT6CQ.js" as="script"><link rel="prefetch" href="/assets/è®¤è¯æ¨¡å—.html-B25bJ3yE.js" as="script"><link rel="prefetch" href="/assets/é…ç½®æ–‡ä»¶åŠ è§£å¯†æ¨¡å—.html-DfEhlWjP.js" as="script"><link rel="prefetch" href="/assets/nacos.html-B423p-iY.js" as="script"><link rel="prefetch" href="/assets/æ—¥å¿—.html-CrzOT-Fw.js" as="script"><link rel="prefetch" href="/assets/ç†”æ–­.html-ChBJvY-L.js" as="script"><link rel="prefetch" href="/assets/è®¤è¯.html-CwkmVQSh.js" as="script"><link rel="prefetch" href="/assets/è·¯ç”±.html-Dq3aMhdP.js" as="script"><link rel="prefetch" href="/assets/é™æµ.html-B6rxt4oJ.js" as="script"><link rel="prefetch" href="/assets/é€šç”¨é“¾è·¯è·Ÿè¸ªæ¨¡å—.html-C2YN2hSw.js" as="script"><link rel="prefetch" href="/assets/é¹°çœ¼æ¨¡å—.html-DxAMVjlK.js" as="script"><link rel="prefetch" href="/assets/index.html-sARh2OIG.js" as="script"><link rel="prefetch" href="/assets/index.html-D5VbzMTu.js" as="script"><link rel="prefetch" href="/assets/å¹¶å‘ç¼–ç¨‹.html-BFxnFUEV.js" as="script"><link rel="prefetch" href="/assets/ç±»å›¾-UML.html-DwIBCHZD.js" as="script"><link rel="prefetch" href="/assets/SpringCloud 1.html-C1XN71Pm.js" as="script"><link rel="prefetch" href="/assets/SpringCloud 2.html-DAtz4Amh.js" as="script"><link rel="prefetch" href="/assets/SpringCloud 3.html-Cevfs-eK.js" as="script"><link rel="prefetch" href="/assets/index.html-CYHGlbQO.js" as="script"><link rel="prefetch" href="/assets/MySQL.html-BUMB4BLf.js" as="script"><link rel="prefetch" href="/assets/SQLä¼˜åŒ–.html-DN_sRe_n.js" as="script"><link rel="prefetch" href="/assets/ä¸€æ¬¡SQLä¼˜åŒ–è®°å½•.html-Bh5XVvGx.js" as="script"><link rel="prefetch" href="/assets/å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶äº‹åŠ¡.html-RQNwljqo.js" as="script"><link rel="prefetch" href="/assets/Oracle.html-1jZwYLZg.js" as="script"><link rel="prefetch" href="/assets/Redis.html-d4wcYnK4.js" as="script"><link rel="prefetch" href="/assets/æ•°ä¹‹å’Œ.html-DZFYXeeY.js" as="script"><link rel="prefetch" href="/assets/æœ‰åºæ•°ç»„çš„å¹³æ–¹.html-BOHI7vp6.js" as="script"><link rel="prefetch" href="/assets/ç§»é™¤å…ƒç´ .html-Cmd24nfD.js" as="script"><link rel="prefetch" href="/assets/èºæ—‹çŸ©é˜µ.html-T1icxynC.js" as="script"><link rel="prefetch" href="/assets/é“¾è¡¨ç¯‡.html-BYaXULiP.js" as="script"><link rel="prefetch" href="/assets/é•¿åº¦æœ€å°çš„æ•°ç»„.html-C7snmJ5N.js" as="script"><link rel="prefetch" href="/assets/index.html-7rILkgil.js" as="script"><link rel="prefetch" href="/assets/å¿«é€Ÿæ’åºå’Œå †æ’åº.html-ZtF9wmuY.js" as="script"><link rel="prefetch" href="/assets/äºŒåˆ†æ³•.html-BijuUzI3.js" as="script"><link rel="prefetch" href="/assets/å“ˆå¸Œç¯‡.html-BG6uM9DY.js" as="script"><link rel="prefetch" href="/assets/é“¾è¡¨.html-CwP7y5Ir.js" as="script"><link rel="prefetch" href="/assets/Docker.html-B2sgCiBF.js" as="script"><link rel="prefetch" href="/assets/æ•°æ®ç»“æ„å›¾ç¤º.html-DxB96Ei5.js" as="script"><link rel="prefetch" href="/assets/å®ä¾‹åŒ–Node.html-ZbcHkGmU.js" as="script"><link rel="prefetch" href="/assets/å¯¹è±¡é—´çš„å…³ç³».html-W-pYFWnG.js" as="script"><link rel="prefetch" href="/assets/ThreadLocal.html-D6wemK4P.js" as="script"><link rel="prefetch" href="/assets/å…³é”®å­—.html-TdPMErrz.js" as="script"><link rel="prefetch" href="/assets/404.html-Cpm13-JQ.js" as="script"><link rel="prefetch" href="/assets/index.html-CxR8ULZJ.js" as="script"><link rel="prefetch" href="/assets/index.html-BCeKSjhT.js" as="script"><link rel="prefetch" href="/assets/index.html-D9KPj6qQ.js" as="script"><link rel="prefetch" href="/assets/index.html-FyrOxmdi.js" as="script"><link rel="prefetch" href="/assets/index.html-C6T7x-oJ.js" as="script"><link rel="prefetch" href="/assets/index.html-BSCU9o1g.js" as="script"><link rel="prefetch" href="/assets/index.html-CnKr6-je.js" as="script"><link rel="prefetch" href="/assets/index.html-DiLbUlOG.js" as="script"><link rel="prefetch" href="/assets/index.html-DxvnBYUl.js" as="script"><link rel="prefetch" href="/assets/index.html-CV9hgv-g.js" as="script"><link rel="prefetch" href="/assets/index.html-DLYAOzyd.js" as="script"><link rel="prefetch" href="/assets/index.html-DBY1UYd7.js" as="script"><link rel="prefetch" href="/assets/index.html-D0jcBBMZ.js" as="script"><link rel="prefetch" href="/assets/index.html-KBqVbZXI.js" as="script"><link rel="prefetch" href="/assets/index.html-Sc99Z7NP.js" as="script"><link rel="prefetch" href="/assets/index.html-Cy-4WUtu.js" as="script"><link rel="prefetch" href="/assets/index.html-DYOqxnb5.js" as="script"><link rel="prefetch" href="/assets/index.html-CdoMT6rk.js" as="script"><link rel="prefetch" href="/assets/index.html-COQ2GxEG.js" as="script"><link rel="prefetch" href="/assets/index.html-DHDanH2D.js" as="script"><link rel="prefetch" href="/assets/index.html-DNZQajfn.js" as="script"><link rel="prefetch" href="/assets/index.html-CnANjUEL.js" as="script"><link rel="prefetch" href="/assets/index.html-DAtMlu9r.js" as="script"><link rel="prefetch" href="/assets/index.html-BzpxpFZb.js" as="script"><link rel="prefetch" href="/assets/index.html-BFwgjvDj.js" as="script"><link rel="prefetch" href="/assets/index.html-CuT7uSM0.js" as="script"><link rel="prefetch" href="/assets/index.html-CdHny7gG.js" as="script"><link rel="prefetch" href="/assets/index.html-BCcPlr2g.js" as="script"><link rel="prefetch" href="/assets/index.html-DxRjNECp.js" as="script"><link rel="prefetch" href="/assets/index.html-B7NjrE12.js" as="script"><link rel="prefetch" href="/assets/index.html-D93p1IMG.js" as="script"><link rel="prefetch" href="/assets/index.html-CumxJxNE.js" as="script"><link rel="prefetch" href="/assets/index.html-CEvdz964.js" as="script"><link rel="prefetch" href="/assets/index.html-_5k8rdMz.js" as="script"><link rel="prefetch" href="/assets/index.html-Bg_fhPJ2.js" as="script"><link rel="prefetch" href="/assets/index.html-aupX84wW.js" as="script"><link rel="prefetch" href="/assets/index.html-C9CqhrfQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DAPXys0Q.js" as="script"><link rel="prefetch" href="/assets/index.html-DCWDPt__.js" as="script"><link rel="prefetch" href="/assets/index.html-C0G1KY8j.js" as="script"><link rel="prefetch" href="/assets/index.html-309mQZs0.js" as="script"><link rel="prefetch" href="/assets/index.html-CY96oIji.js" as="script"><link rel="prefetch" href="/assets/index.html-BI6NBIuh.js" as="script"><link rel="prefetch" href="/assets/index.html-Bi7cJKTe.js" as="script"><link rel="prefetch" href="/assets/index.html-CcCkJG_q.js" as="script"><link rel="prefetch" href="/assets/index.html-PuHo7rgE.js" as="script"><link rel="prefetch" href="/assets/index.html-DmG4s-2g.js" as="script"><link rel="prefetch" href="/assets/index.html-DmpZYpm4.js" as="script"><link rel="prefetch" href="/assets/index.html-Ff89vAya.js" as="script"><link rel="prefetch" href="/assets/index.html-BuKpQW3r.js" as="script"><link rel="prefetch" href="/assets/index.html-DujI-0eF.js" as="script"><link rel="prefetch" href="/assets/index.html-ptbegCIg.js" as="script"><link rel="prefetch" href="/assets/index.html-RHWCqdfC.js" as="script"><link rel="prefetch" href="/assets/index.html-96VfiVD9.js" as="script"><link rel="prefetch" href="/assets/index.html-CQxbyZVW.js" as="script"><link rel="prefetch" href="/assets/index.html-CIyQMUVY.js" as="script"><link rel="prefetch" href="/assets/index.html-MRmoJVYv.js" as="script"><link rel="prefetch" href="/assets/index.html-BZ9CWZsa.js" as="script"><link rel="prefetch" href="/assets/index.html-WTqnwQlc.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/assets/index-BNnYFWcz.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/ç§’é€Ÿï¼•ã‚»ãƒ³ãƒãƒ¡ãƒ¼ãƒˆãƒ«.svg" alt><!----><!----></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="é›¨å±±"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-user-graduate" style=""></span><!--]-->é›¨å±±<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/portfolio.html" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/demo/" aria-label="æ–‡æ¡£å’Œç¬”è®°"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><!--]-->æ–‡æ¡£å’Œç¬”è®°<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E5%8F%8B%E9%93%BE.html" aria-label="æœ‹å‹ä»¬"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-user-graduate" style=""></span><!--]-->æœ‹å‹ä»¬<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/Todreamr/Dr.Magic" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:none;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:block;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><span class="vp-sidebar-title">åç«¯ç†è®º</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-check-square" style=""></span><span class="vp-sidebar-title">ç›˜å¤</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">ä¸­é—´ä»¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">æ•°æ®æº</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">ç»„ä»¶ä»‹ç»</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/chat%E6%A8%A1%E5%9D%97.html" aria-label="chatæ¨¡å—"><!---->chatæ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E5%BB%B6%E6%97%B6%E6%A8%A1%E5%9D%97.html" aria-label="Delayæ¨¡å—"><!---->Delayæ¨¡å—<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E7%9B%98%E5%8F%A4-security.html" aria-label="Feignæ¨¡å—"><!---->Feignæ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/Https%E6%A8%A1%E5%9D%97.html" aria-label="Httpsæ¨¡å—"><!---->Httpsæ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/Mybatis-Plus.html" aria-label="MybatisPlusæ¨¡å—"><!---->MybatisPlusæ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/plug%E7%BB%84%E4%BB%B6.html" aria-label="plugç»„ä»¶"><!---->plugç»„ä»¶<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/SQL%E8%B7%9F%E8%B8%AA%E6%A8%A1%E5%9D%97.html" aria-label="SQLè·Ÿè¸ªæ¨¡å—"><!---->SQLè·Ÿè¸ªæ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/Swagger.html" aria-label="Swaggeræ¨¡å—"><!---->Swaggeræ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/xxl-job%E6%A8%A1%E5%9D%97.html" aria-label="xxl-jobæ¨¡å—"><!---->xxl-jobæ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E4%BB%93%E7%9B%92%E6%A8%A1%E5%9D%97.html" aria-label="ä»“ç›’æ¨¡å—"><!---->ä»“ç›’æ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E5%B7%A5%E5%85%B7%E7%B1%BB.html" aria-label="å·¥å…·ç±»"><!---->å·¥å…·ç±»<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E5%BC%82%E5%B8%B8%E6%A8%A1%E5%9D%97.html" aria-label="å¼‚å¸¸æ¨¡å—"><!---->å¼‚å¸¸æ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E6%8E%A7%E5%88%B6%E5%99%A8%E6%8E%92%E9%99%A4%E6%A8%A1%E5%9D%97.html" aria-label="æ§åˆ¶å™¨æ’é™¤æ¨¡å—"><!---->æ§åˆ¶å™¨æ’é™¤æ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E7%BC%93%E5%AD%98%E6%A8%A1%E5%9D%97.html" aria-label="æœ¬åœ°ç¼“å­˜æ¨¡å—(å·¥å…·)"><!---->æœ¬åœ°ç¼“å­˜æ¨¡å—(å·¥å…·)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E6%A1%86%E6%9E%B6%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97.html" aria-label="æ¡†æ¶æ—¥å¿—æ¨¡å—"><!---->æ¡†æ¶æ—¥å¿—æ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E7%9B%98%E5%8F%A4security%E6%A8%A1%E5%9D%97(%E5%90%AB%E6%8E%88%E6%9D%83).html" aria-label="ç›˜å¤securityæ¨¡å—(å«æˆæƒ)"><!---->ç›˜å¤securityæ¨¡å—(å«æˆæƒ)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/list%E5%B7%A5%E4%BD%9C%E6%B5%81%E9%9B%86%E6%88%90.html" aria-label="ç½‘å…³-é™æµ"><!---->ç½‘å…³-é™æµ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E8%84%B1%E6%95%8F%E5%92%8C%E6%8C%81%E4%B9%85%E5%B1%82%E5%8A%A0%E8%A7%A3%E5%AF%86.html" aria-label="è„±æ•&amp;æŒä¹…å±‚åŠ è§£å¯†"><!---->è„±æ•&amp;æŒä¹…å±‚åŠ è§£å¯†<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E7%9B%98%E5%8F%A4.html" aria-label="è‡ªç ”çš„åˆ†å¸ƒå¼æ¡†æ¶-ç›˜å¤"><!---->è‡ªç ”çš„åˆ†å¸ƒå¼æ¡†æ¶-ç›˜å¤<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E8%AE%A4%E8%AF%81%E6%A8%A1%E5%9D%97.html" aria-label="è®¤è¯æ¨¡å—"><!---->è®¤è¯æ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E8%A7%A3%E5%AF%86%E6%A8%A1%E5%9D%97.html" aria-label="é…ç½®æ–‡ä»¶åŠ è§£å¯†æ¨¡å—"><!---->é…ç½®æ–‡ä»¶åŠ è§£å¯†æ¨¡å—<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">ç½‘å…³</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">é¹°çœ¼æ¡†æ¶</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">æ€è€ƒ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-check-square" style=""></span><span class="vp-sidebar-title">å¸®åŠ©</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Feignæ¨¡å—</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/ToDreamr" target="_blank" rel="noopener noreferrer">Cotton Eye Joe</a></span><span property="author" content="Cotton Eye Joe"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-11-18T07:25:41.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 11 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT11M"></span><!----><!----></div><hr></div><!----><!----><div class="theme-hope-content"><h1 id="feignæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#feignæ¨¡å—"><span>Feignæ¨¡å—</span></a></h1><blockquote><h4 id="å¦‚ä½•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨"><span>å¦‚ä½•ä½¿ç”¨</span></a></h4></blockquote><p>å¼•ç”¨å¦‚ä¸‹æ¨¡å—</p><p><strong>xml</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>  &lt;groupId&gt;com.kingtsoft.pangu&lt;/groupId&gt;</span></span>
<span class="line"><span>  &lt;artifactId&gt;pangu-springcloud-feign&lt;/artifactId&gt;</span></span>
<span class="line"><span>  &lt;version&gt;${pangu.version}&lt;/version&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    å®šä¹‰feignClient(ä¿è¯Clientæ‰€åœ¨åŒ…ä¸­æœ‰apiæˆ–è€…feignè¿™ä¸ªè·¯å¾„)ï¼Œä¾‹å¦‚com.kingtsoft.pangu.frame.simple.test.api</span></span>
<span class="line"><span>com.kingtsoft.pangu.frame.simple.test.feign</span></span>
<span class="line"><span>å¿…é¡»è¦æœ‰PgFeignClientæ ‡è®°æ‰ä¼šåˆå§‹åŒ–ä¸ºå®¢æˆ·ç«¯</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@FeignResultClient</span></span>
<span class="line"><span>@PgFeignClient(clientCode=&quot;pangu-frame-simple&quot;, basePath=&quot;pangu-xdev&quot;, url=&quot;https://127.0.0.1:10240/pangu-xdev&quot;, loadBalance=false)</span></span>
<span class="line"><span>public interface  TestCallAnoServiceApi {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    String SUF =&quot;/pub/test&quot;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @RequestMapping(value= SUF +&quot;/testAnoCall?a=1&amp;b=3&quot;, method= RequestMethod.POST)</span></span>
<span class="line"><span>    String doSomething(@RequestBody OisRegSchedule abc);</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    ä½¿ç”¨å¦‚ä¸‹ï¼Œç›´æ¥æ³¨å…¥TestCallAnoServiceApi</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>private void   testCall() {</span></span>
<span class="line"><span>    log.info(&quot;doCall&quot;);</span></span>
<span class="line"><span>    OisRegSchedule oisRegSchedule =newOisRegSchedule();</span></span>
<span class="line"><span>    oisRegSchedule.setScheduleSn(1L);</span></span>
<span class="line"><span>    String abc = testCallAnoServiceApi.doSomething( oisRegSchedule);</span></span>
<span class="line"><span>    System.out.println(abc);</span></span>
<span class="line"><span>    log.info(&quot;end&quot;);</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ³¨è§£ä»‹ç»</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>PgFeignClient</span></span>
<span class="line"><span>    urlï¼šç›´æ¥å£°æ˜è¯·æ±‚åœ°å€ï¼Œè‹¥ä¸ºåŸŸåï¼Œè¯·æŠŠloadBalanceæ ‡è®°ä¸ºfalseï¼Œå¦åˆ™ä¼šæŠŠåŸŸåå½“</span></span>
<span class="line"><span>ä½œè´Ÿè½½æ ‡è®°å»è¯†åˆ«ã€‚å¹¶ä¸”æ”¯æŒä½¿ç”¨${}çš„æ–¹å¼è·å–é…ç½®æ–‡ä»¶çš„é…ç½®ã€‚</span></span>
<span class="line"><span>    clientCodeï¼šå®¢æˆ·ç«¯ä»£ç ï¼Œæœ€å¥½å”¯ä¸€ã€‚åœ¨æ²¡æœ‰urlçš„æƒ…å†µä¸‹ï¼Œä¼šä½œä¸ºè´Ÿè½½æ ‡è®°å‰ç¼€</span></span>
<span class="line"><span>    encoderï¼šç¼–ç é…ç½®ï¼Œé»˜è®¤SPRINGè‡ªå¸¦æ¨¡å¼ï¼Œå¯é€‰GSONåŠFORMæ¨¡å¼</span></span>
<span class="line"><span>    (æ³¨æ„ï¼Œæ ¹æ®feignæœºåˆ¶ï¼Œæ•°æ®è¿”å›å¹¶ä¸ä¼šä½¿ç”¨è¿™é‡Œé…ç½®çš„encoderï¼Œé™¤éæ˜¯å¼‚æ­¥feignå®¢æˆ·ç«¯)</span></span>
<span class="line"><span>    configurationï¼šé…ç½®è‡ªå®šä¹‰é…ç½®ï¼Œæ”¯æŒfeignå®¢æˆ·ç«¯é…ç½®ï¼Œæ‹¦æˆªå™¨é…ç½®ï¼Œç¼–ç ï¼Œè§£ç ç­‰ï¼Œå¦‚ä¸‹ä¸ºæ¡ˆä¾‹</span></span>
<span class="line"><span>    basePathï¼šåŸºç¡€è·¯å¾„ï¼Œåœ¨è´Ÿè½½ä¸”ä¸ç”¨ç½‘å…³çš„æƒ…å†µä¸‹ã€‚è·¯å¾„è§£æå¯èƒ½åªåˆ°ç«¯å£ã€‚ä½¿ç”¨æ­¤å±æ€§ä¼šåœ¨ç«¯å£ä¹‹åé…ç½®ä¸ªåŸºç¡€è·¯å¾„ã€‚</span></span>
<span class="line"><span>    loadBalanceï¼šæ˜¯å¦å¼€å¯è´Ÿè½½å‡è¡¡æ¨¡å¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@Configuration</span></span>
<span class="line"><span>public class  FeignClientConfiguration {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public Feign.Builder pgFeignBuild() {</span></span>
<span class="line"><span>        Feign.Builder builder =getFeignBuildDefault();</span></span>
<span class="line"><span>buildInterceptors(builder);</span></span>
<span class="line"><span>        String wn = environment.getProperty(&quot;feign.write-nulls&quot;);</span></span>
<span class="line"><span>boolean   writeNulls = StringUtils.hasText(wn) &amp;&amp; boolean  .parseboolean  (wn);</span></span>
<span class="line"><span>// ä½¿ç”¨fastjsonä½œä¸ºfeignçš„æ¶ˆæ¯è½¬æ¢å™¨</span></span>
<span class="line"><span>        ObjectFactory&lt;HttpMessageConverters&gt; feignObjectFactory = PgFeignUtil.initFeignNewConverters(messageConverters, writeNulls);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>return builder</span></span>
<span class="line"><span>        .contract(contract)</span></span>
<span class="line"><span>        .encoder(newSpringEncoder(feignObjectFactory))</span></span>
<span class="line"><span>        .decoder(newSpringDecoder(feignObjectFactory, customizers));</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public Feign.Builder pgFeignGsonBuild() {</span></span>
<span class="line"><span>        Feign.Builder builder =getFeignBuildDefault();</span></span>
<span class="line"><span>buildInterceptors(builder);</span></span>
<span class="line"><span>return builder</span></span>
<span class="line"><span>        .contract(contract)</span></span>
<span class="line"><span>        .encoder(newGsonEncoder())</span></span>
<span class="line"><span>        .decoder(newGsonDecoder());</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public Feign.Builder pgFeignFormBuild() {</span></span>
<span class="line"><span>        Feign.Builder builder =getFeignBuildDefault();</span></span>
<span class="line"><span>buildInterceptors(builder);</span></span>
<span class="line"><span>        String wn = environment.getProperty(&quot;feign.write-nulls&quot;);</span></span>
<span class="line"><span>boolean   writeNulls = StringUtils.hasText(wn) &amp;&amp; boolean  .parseboolean  (wn);</span></span>
<span class="line"><span>// ä½¿ç”¨fastjsonä½œä¸ºfeignçš„æ¶ˆæ¯è½¬æ¢å™¨</span></span>
<span class="line"><span>        ObjectFactory&lt;HttpMessageConverters&gt; feignObjectFactory = PgFeignUtil.initFeignNewConverters(messageConverters, writeNulls);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>return builder</span></span>
<span class="line"><span>        .contract(contract)</span></span>
<span class="line"><span>        .encoder(newSpringFormEncoder(newSpringEncoder(feignObjectFactory)))</span></span>
<span class="line"><span>        .decoder(newSpringDecoder(feignObjectFactory, customizers));</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private Feign.Builder getFeignBuildDefault() {</span></span>
<span class="line"><span>// å› ä¸ºscopeä¸ºprototypeï¼Œæ¯æ¬¡è·å–beanéƒ½ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡</span></span>
<span class="line"><span>return beanFactory.getBean(&quot;feignBuilder&quot;, Feign.Builder.class);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>#æ­¤æ³¨è§£ç”¨äºå¤„ç†è¿”å›å€¼ä¿¡æ¯</span></span>
<span class="line"><span>FeignResultClientï¼š</span></span>
<span class="line"><span>    valueï¼šè¿”å›å€¼å¤„ç†å™¨ç±»</span></span>
<span class="line"><span>    coverMethodï¼šå¤„ç†å™¨çš„æ–¹æ³•</span></span>
<span class="line"><span>    postfixï¼šåªå¤„ç†æ ‡è®°å¤„ç†çš„åç¼€</span></span>
<span class="line"><span>æ­¤æ³¨è§£æ ‡è®°çš„ç±»ä¸‹çš„æ–¹æ³•æˆ–è€…æ–¹æ³•çš„è¿”å›å€¼ä¼šç»è¿‡å¤„ç†ç±»ï¼Œå¥–å¤„ç†ç±»åçš„ç»“æœå†è¿”å›ç»™è°ƒç”¨æ–¹ï¼Œ</span></span>
<span class="line"><span>è¿™æ ·feignå®šä¹‰å°±å¯ä»¥ç›´æ¥å®šä¹‰å®é™…çš„å€¼éƒ¨åˆ†å†…å®¹ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h4 id="æŠ€æœ¯åŸç†" tabindex="-1"><a class="header-anchor" href="#æŠ€æœ¯åŸç†"><span>æŠ€æœ¯åŸç†</span></a></h4></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    é¦–å…ˆæ˜¯feignå®¢æˆ·ç«¯çš„æ‰«æï¼Œé€šè¿‡è‡ªå®šä¹‰æ‰«æï¼Œå¯¹è·¯å¾„å¸¦æœ‰apiåŠfeignçš„BeanDefinition</span></span>
<span class="line"><span>è¿›è¡Œäº†æ‰«æã€‚å†å»è¿™äº›BeanDefinitionåˆ¤æ–­æ˜¯å¦å­˜åœ¨è‡ªå®šä¹‰çš„PgFeignClientæ³¨è§£</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>protected ClassPathScanningCandidateComponentProvider getScanner() {</span></span>
<span class="line"><span>returnnewClassPathScanningCandidateComponentProvider(false, this.environment) {</span></span>
<span class="line"><span>        @Override</span></span>
<span class="line"><span>protectedboolean  isCandidateComponent(@NonNull MetadataReader metadataReader) {</span></span>
<span class="line"><span>            Optional&lt;String&gt; target = metadataReader.getAnnotationMetadata().getAnnotationTypes().stream().filter(</span></span>
<span class="line"><span>                sn -&gt; sn.equals(PgFeignClient.class.getName())</span></span>
<span class="line"><span>            ).findAny();</span></span>
<span class="line"><span>return target.isPresent();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        @Override</span></span>
<span class="line"><span>protectedboolean  isCandidateComponent(@NonNull AnnotatedBeanDefinition beanDefinition) {</span></span>
<span class="line"><span>return beanDefinition.getMetadata().isInterface() &amp;&amp;!beanDefinition.getMetadata().isAnnotation();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ClassLoader classLoader = Thread.currentThread().getContextClassLoader();</span></span>
<span class="line"><span>ClassPathScanningCandidateComponentProvider scanner =getScanner();</span></span>
<span class="line"><span>scanner.setResourceLoader(this.resourceLoader);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Set&lt;BeanDefinition&gt; beanDefinitions =new LinkedHashSet&lt;&gt;();</span></span>
<span class="line"><span>for (String pkg : PKG_ARR) {</span></span>
<span class="line"><span>    Set&lt;BeanDefinition&gt; beanDefinitions2 = scanner.findCandidateComponents(pkg);</span></span>
<span class="line"><span>    beanDefinitions.addAll(beanDefinitions2);</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    é»˜è®¤åŠ å…¥äº†å¯¹okhttpçš„æ”¯æŒï¼Œä½¿ç”¨çš„okhttpclientä½œä¸ºè°ƒç”¨å®¢æˆ·ç«¯ï¼Œæ‹¥æœ‰é˜Ÿåˆ—çº¿ç¨‹æ± ï¼Œè½»æ¾å†™å¹¶å‘</span></span>
<span class="line"><span>æ‹¥æœ‰Interceptorsç­‰ç‰¹æ€§ã€‚å¹¶ä¸”æ ¹æ®æ³¨è§£é…ç½®ï¼Œè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦ç”Ÿæˆè´Ÿè½½å®¢æˆ·ç«¯ã€‚</span></span>
<span class="line"><span>    ä»¥ä¸‹ä¸ºè‡ªåŠ¨åŒ–é…ç½®ç±»åˆå§‹åŒ–å†…å®¹</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>package com.kingtsoft.pangu.springcloud.feign;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Title: &lt;br&gt;</span></span>
<span class="line"><span> * Description: &lt;br&gt;</span></span>
<span class="line"><span> * Company: KingTang &lt;br&gt;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * @author é‡‘ç‚€</span></span>
<span class="line"><span> * @version 1.0</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>@Import({FeignClientsConfiguration.class, FeignConfiguration.class, PgFeignClientConfiguration.class })</span></span>
<span class="line"><span>@ConditionalOnClass(Feign.class)</span></span>
<span class="line"><span>@AutoConfigureBefore({org.springframework.cloud.openfeign.FeignAutoConfiguration.class})</span></span>
<span class="line"><span>@AutoConfigureAfter(name= {&quot;com.kingtsoft.pangu.springcloud.nacos.NacosAutoConfiguration&quot;})</span></span>
<span class="line"><span>@Configuration</span></span>
<span class="line"><span>public class  FeignAutoConfigurationimplementsEnvironmentAware {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /** ç”±äºå¼•å…¥PgFeignClientConfigurationçš„ç”Ÿå‘½å‘¨æœŸæ¯”é¢„è®¡çš„æ—©ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æ‰‹åŠ¨ç»‘å®šï¼Œä¸ç„¶ä¼šå‘ç°æ³¨å…¥çš„ç±»æ— æ³•è¢«ç»‘å®š */</span></span>
<span class="line"><span>privatestatic PgFeignOkHttpProperties pgFeignOkHttpProperties =newPgFeignOkHttpProperties();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>privatestatic LoadBalancerClientsProperties balancerClientsProperties =newLoadBalancerClientsProperties();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Bean</span></span>
<span class="line"><span>    @Scope(&quot;prototype&quot;)</span></span>
<span class="line"><span>public AsyncFeign.AsyncBuilder&lt;?&gt; asyncFeignBuilder(Retryer retryer) {</span></span>
<span class="line"><span>return AsyncFeign.asyncBuilder().retryer(retryer);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Bean</span></span>
<span class="line"><span>    @ConditionalOnMissingBean(HttpMessageConverters.class)</span></span>
<span class="line"><span>public HttpMessageConverters messageConverters(ObjectProvider&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {</span></span>
<span class="line"><span>returnnewHttpMessageConverters(converters.orderedStream().collect(Collectors.toList()));</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Bean</span></span>
<span class="line"><span>    @ConditionalOnMissingBean(FeignResultCoverRegister.class)</span></span>
<span class="line"><span>public FeignResultCoverRegister feignResultCoverRegister() {</span></span>
<span class="line"><span>returnnewFeignResultCoverRegister();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Bean</span></span>
<span class="line"><span>public OkHttpLogInterceptor okHttpLogInterceptor() {</span></span>
<span class="line"><span>returnnewOkHttpLogInterceptor();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Bean</span></span>
<span class="line"><span>public PgFeignProperties pgFeignProperties(Environment environment) {</span></span>
<span class="line"><span>        BindResult&lt;PgFeignProperties&gt; ret = Binder.get(environment)</span></span>
<span class="line"><span>                .bind(PgFeignProperties.PREFIX, PgFeignProperties.class);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        PgFeignProperties pgFeignProperties =newPgFeignProperties();</span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>if (ret.get() !=null) {</span></span>
<span class="line"><span>                pgFeignProperties = ret.get();</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        } catch (Exception ignore) {}</span></span>
<span class="line"><span>return pgFeignProperties;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Bean</span></span>
<span class="line"><span>    @ConditionalOnWebApplication</span></span>
<span class="line"><span>    @ConditionalOnMissingBean(FeignRequestInterceptor.class)</span></span>
<span class="line"><span>public FeignRequestInterceptor feignRequestInterceptor(PgFeignProperties pgFeignProperties) {</span></span>
<span class="line"><span>returnnewFeignRequestInterceptor(pgFeignProperties);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Bean</span></span>
<span class="line"><span>public OkHttpResultInterceptor okHttpResultInterceptor(FeignResultCoverRegister feignResultCoverRegister) {</span></span>
<span class="line"><span>returnnewOkHttpResultInterceptor(feignResultCoverRegister);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Bean</span></span>
<span class="line"><span>public OkHttpCusUrlInterceptor okHttpCusUrlInterceptor() {</span></span>
<span class="line"><span>returnnewOkHttpCusUrlInterceptor();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// è¿™ä¸ªbeanæ˜¯ä¸ºäº†å…¼å®¹è€çš„ä¸€äº›å†™æ³•</span></span>
<span class="line"><span>    @Bean(&quot;pgFeignBuild&quot;)</span></span>
<span class="line"><span>    @Primary</span></span>
<span class="line"><span>public Feign.Builder pgFeignBuild(Contract contract,</span></span>
<span class="line"><span>                                      @Qualifier(&quot;feignBuilder&quot;) Feign.Builder builder,</span></span>
<span class="line"><span>                                      @Qualifier(&quot;okHttpFeignClient&quot;) Client okHttpClient,</span></span>
<span class="line"><span>                                      ObjectFactory&lt;HttpMessageConverters&gt; messageConverters,</span></span>
<span class="line"><span>                                      ObjectProvider&lt;HttpMessageConverterCustomizer&gt; customizers,</span></span>
<span class="line"><span>                                      Environment environment) {</span></span>
<span class="line"><span>        String wn = environment.getProperty(&quot;feign.write-nulls&quot;);</span></span>
<span class="line"><span>boolean   writeNulls = StringUtils.hasText(wn) &amp;&amp; boolean  .parseboolean  (wn);</span></span>
<span class="line"><span>// ä½¿ç”¨fastjsonä½œä¸ºfeignçš„æ¶ˆæ¯è½¬æ¢å™¨</span></span>
<span class="line"><span>        ObjectFactory&lt;HttpMessageConverters&gt; feignObjectFactory = PgFeignUtil.initFeignNewConverters(messageConverters, writeNulls);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>return builder</span></span>
<span class="line"><span>                .client(okHttpClient)</span></span>
<span class="line"><span>                .contract(contract)</span></span>
<span class="line"><span>                .encoder(newSpringEncoder(feignObjectFactory))</span></span>
<span class="line"><span>                .decoder(newSpringDecoder(feignObjectFactory, customizers));</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   setEnvironment(@NonNull Environment environment) {</span></span>
<span class="line"><span>        BindResult&lt;PgFeignOkHttpProperties&gt; ret = Binder.get(environment)</span></span>
<span class="line"><span>                .bind(PgFeignOkHttpProperties.PREFIX, PgFeignOkHttpProperties.class);</span></span>
<span class="line"><span>        BindResult&lt;LoadBalancerClientsProperties&gt; blRet = Binder.get(environment)</span></span>
<span class="line"><span>                .bind(&quot;spring.cloud.loadbalancer&quot;, LoadBalancerClientsProperties.class);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>if (ret.get() !=null) {</span></span>
<span class="line"><span>                pgFeignOkHttpProperties = ret.get();</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        } catch (Exception ignore) {}</span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>if (blRet.get() !=null) {</span></span>
<span class="line"><span>                balancerClientsProperties = blRet.get();</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        } catch (Exception ignore) {}</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Configuration(proxyBeanMethods=false)</span></span>
<span class="line"><span>    @ConditionalOnClass(OkHttpClient.class)</span></span>
<span class="line"><span>protectedstaticclassOkHttpFeignConfiguration {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private OkHttpClient okHttpClient;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        @Bean</span></span>
<span class="line"><span>        @ConditionalOnMissingBean(ConnectionPool.class)</span></span>
<span class="line"><span>public ConnectionPool httpClientConnectionPool(FeignHttpClientProperties httpClientProperties,</span></span>
<span class="line"><span>                                                       OkHttpClientConnectionPoolFactory connectionPoolFactory) {</span></span>
<span class="line"><span>int maxTotalConnections = httpClientProperties.getMaxConnections();</span></span>
<span class="line"><span>long  timeToLive = httpClientProperties.getTimeToLive();</span></span>
<span class="line"><span>            TimeUnit ttlUnit = httpClientProperties.getTimeToLiveUnit();</span></span>
<span class="line"><span>return connectionPoolFactory.create(maxTotalConnections, timeToLive, ttlUnit);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        @Bean(&quot;okHttpLoadBalancerClient&quot;)</span></span>
<span class="line"><span>public Client okHttpLoadBalancerClient(OkHttpLogInterceptor okHttpLogInterceptor,</span></span>
<span class="line"><span>                                               OkHttpResultInterceptor okHttpResultInterceptor,</span></span>
<span class="line"><span>                                               OkHttpCusUrlInterceptor okHttpCusUrlInterceptor,</span></span>
<span class="line"><span>                                               LoadBalancerClient loadBalancerClient,</span></span>
<span class="line"><span>                                               LoadBalancerClientFactory loadBalancerClientFactory) {</span></span>
<span class="line"><span>if (this.okHttpClient ==null) {</span></span>
<span class="line"><span>this.okHttpClient =getOkhttp(okHttpLogInterceptor, okHttpResultInterceptor, okHttpCusUrlInterceptor);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>returnnewFeignBlockingLoadBalancerClient(this.okHttpClient, loadBalancerClient, loadBalancerClientFactory);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        @ConditionalOnMissingBean</span></span>
<span class="line"><span>        @Bean</span></span>
<span class="line"><span>public LoadBalancerClientFactory loadBalancerClientFactory(ObjectProvider&lt;List&lt;LoadBalancerClientSpecification&gt;&gt; configurations) {</span></span>
<span class="line"><span>            LoadBalancerClientFactory clientFactory =newLoadBalancerClientFactory(balancerClientsProperties);</span></span>
<span class="line"><span>            clientFactory.setConfigurations(configurations.getIfAvailable(Collections::emptyList));</span></span>
<span class="line"><span>return clientFactory;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        @Bean(&quot;okHttpFeignClient&quot;)</span></span>
<span class="line"><span>//        @ConditionalOnMissingBean(OkHttpClient.class)</span></span>
<span class="line"><span>public OkHttpClient okHttpFeignClient(OkHttpLogInterceptor okHttpLogInterceptor,</span></span>
<span class="line"><span>                                              OkHttpResultInterceptor okHttpResultInterceptor,</span></span>
<span class="line"><span>                                              OkHttpCusUrlInterceptor okHttpCusUrlInterceptor) {</span></span>
<span class="line"><span>if (this.okHttpClient ==null) {</span></span>
<span class="line"><span>this.okHttpClient =getOkhttp(</span></span>
<span class="line"><span>                        okHttpLogInterceptor, okHttpResultInterceptor, okHttpCusUrlInterceptor);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>returnthis.okHttpClient;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private OkHttpClient getOkhttp(OkHttpLogInterceptor okHttpLogInterceptor,</span></span>
<span class="line"><span>                                       OkHttpResultInterceptor okHttpResultInterceptor,</span></span>
<span class="line"><span>                                       OkHttpCusUrlInterceptor okHttpCusUrlInterceptor) {</span></span>
<span class="line"><span>returnnewOkHttpClient(new okhttp3.OkHttpClient.Builder()</span></span>
<span class="line"><span>// ä¸‰æ¬¡æ¡æ‰‹ + SSLå»ºç«‹è€—æ—¶</span></span>
<span class="line"><span>                    .connectTimeout(pgFeignOkHttpProperties.getConnectTimeout(), TimeUnit.MILLISECONDS)</span></span>
<span class="line"><span>// è®¾ç½®è¯»è¶…æ—¶</span></span>
<span class="line"><span>                    .readTimeout(pgFeignOkHttpProperties.getReadTimeout(), TimeUnit.MILLISECONDS)</span></span>
<span class="line"><span>// ä»å‘èµ·åˆ°ç»“æŸçš„æ€»æ—¶é•¿</span></span>
<span class="line"><span>                    .callTimeout(pgFeignOkHttpProperties.getCallTimeout(), TimeUnit.MILLISECONDS)</span></span>
<span class="line"><span>// è®¾ç½®å†™è¶…æ—¶</span></span>
<span class="line"><span>                    .writeTimeout(pgFeignOkHttpProperties.getWriteTimeout(), TimeUnit.MILLISECONDS)</span></span>
<span class="line"><span>                    .sslSocketFactory(SslSocketClient.getSslSocketFactory(), SslSocketClient.getX509TrustManager())</span></span>
<span class="line"><span>                    .hostnameVerifier(SslSocketClient.getHostnameVerifier())</span></span>
<span class="line"><span>// æ˜¯å¦è‡ªåŠ¨é‡è¿</span></span>
<span class="line"><span>                    .retryOnConnectionFailure(true)</span></span>
<span class="line"><span>                    .connectionPool(newConnectionPool())</span></span>
<span class="line"><span>                    .addInterceptor(okHttpCusUrlInterceptor)</span></span>
<span class="line"><span>                    .addInterceptor(okHttpLogInterceptor)</span></span>
<span class="line"><span>                    .addInterceptor(okHttpResultInterceptor)</span></span>
<span class="line"><span>// æ„å»ºOkHttpClientå¯¹è±¡</span></span>
<span class="line"><span>                    .build());</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        @Bean</span></span>
<span class="line"><span>        @Primary</span></span>
<span class="line"><span>        @ConditionalOnBean(LoadBalancerClientFactory.class)</span></span>
<span class="line"><span>        @ConditionalOnMissingBean</span></span>
<span class="line"><span>public LoadBalancerClient blockingLoadBalancerClient(LoadBalancerClientFactory loadBalancerClientFactory) {</span></span>
<span class="line"><span>returnnewBlockingLoadBalancerClient(loadBalancerClientFactory);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    å¹¶ä¸”åœ¨registerBeanDefinitionsç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå®ç°å¯¹å®¢æˆ·ç«¯æ³¨è§£çš„è§£æåŠé…ç½®ç›¸å…³è§£æï¼Œ</span></span>
<span class="line"><span>æœ€åå¯¹beanå¯¹è±¡çš„è‡ªå®šä¹‰æ³¨å…¥ã€‚(URLçš„è§£æä¼šæ ¹æ®é…ç½®æ–‡ä»¶feign.gate-modeï¼Œæ˜¯å¦æ•´ç†æˆç½‘å…³</span></span>
<span class="line"><span>åœ°å€)ï¼Œå…·ä½“é€»è¾‘å¦‚ä¸‹</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>package com.kingtsoft.pangu.springcloud.feign;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Title: &lt;br&gt;</span></span>
<span class="line"><span> * Description: &lt;br&gt;</span></span>
<span class="line"><span> * Company: KingTang &lt;br&gt;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * @author é‡‘ç‚€</span></span>
<span class="line"><span> * @version 1.0</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@Configuration</span></span>
<span class="line"><span>public class  PgFeignClientConfigurationimplementsEnvironmentAware, ResourceLoaderAware,</span></span>
<span class="line"><span>ImportBeanDefinitionRegistrar {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private DefaultListableBeanFactory beanFactory;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private final   List&lt;RequestInterceptor&gt; requestInterceptors =new ArrayList&lt;&gt;();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private Contract contract;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private ObjectFactory&lt;HttpMessageConverters&gt; messageConverters;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private ObjectProvider&lt;HttpMessageConverterCustomizer&gt; customizers;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private Client okHttpLoadBalancerClient;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private Client okHttpClient;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private Environment environment;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private ResourceLoader resourceLoader;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>privatestaticfinal List&lt;String&gt; PKG_ARR =new ArrayList&lt;&gt;(Arrays.asList(&quot;**.feign&quot;, &quot;**.api&quot;));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private String centerUrl;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>privateboolean   gateMode;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private OkHttpCusUrlInterceptor okHttpCusUrlInterceptor;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   setResourceLoader(@NonNull ResourceLoader resourceLoader) {</span></span>
<span class="line"><span>this.resourceLoader = resourceLoader;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   setEnvironment(@NonNull Environment environment) {</span></span>
<span class="line"><span>this.environment = environment;</span></span>
<span class="line"><span>initGatewayUrl();</span></span>
<span class="line"><span>        String lbStr = environment.getProperty(&quot;feign.gate-mode&quot;);</span></span>
<span class="line"><span>this.gateMode = StringUtils.hasText(lbStr) &amp;&amp; boolean  .parseboolean  (lbStr);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private void  initGatewayUrl() {</span></span>
<span class="line"><span>this.centerUrl = System.getProperties().getProperty(HttpConst.CLIENT_ADDR_GATEWAY);</span></span>
<span class="line"><span>if (StringUtils.hasText(centerUrl)) {</span></span>
<span class="line"><span>return;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>this.centerUrl = System.getenv(HttpConst.CLIENT_ADDR_GATEWAY);</span></span>
<span class="line"><span>if (StringUtils.hasText(centerUrl)) {</span></span>
<span class="line"><span>return;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>this.centerUrl = environment.getProperty(HttpConst.CLIENT_ADDR_GATEWAY);</span></span>
<span class="line"><span>if (!StringUtils.hasText(centerUrl)) {</span></span>
<span class="line"><span>this.centerUrl =&quot;http://localhost&quot;;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   registerBeanDefinitions(@NonNull AnnotationMetadata importingClassMetadata,</span></span>
<span class="line"><span>                                        @NonNull BeanDefinitionRegistry registry) {</span></span>
<span class="line"><span>        beanFactory = (DefaultListableBeanFactory) registry;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        PgFeignProperties pgFeignProperties = beanFactory.getBean(PgFeignProperties.class);</span></span>
<span class="line"><span>        PKG_ARR.addAll(pgFeignProperties.getScans());</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        contract = beanFactory.getBean(Contract.class);</span></span>
<span class="line"><span>        messageConverters = beanFactory.getBeanProvider(HttpMessageConverters.class);</span></span>
<span class="line"><span>        customizers = beanFactory.getBeanProvider(HttpMessageConverterCustomizer.class);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        okHttpLoadBalancerClient = (Client) beanFactory.getBean(&quot;okHttpLoadBalancerClient&quot;);</span></span>
<span class="line"><span>        okHttpClient = (Client) beanFactory.getBean(&quot;okHttpFeignClient&quot;);</span></span>
<span class="line"><span>        okHttpCusUrlInterceptor = beanFactory.getBean(OkHttpCusUrlInterceptor.class);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>String[] interBeanNames = beanFactory.getBeanNamesForType(RequestInterceptor.class);</span></span>
<span class="line"><span>for (String beanName : interBeanNames) {</span></span>
<span class="line"><span>            RequestInterceptor interceptor = (RequestInterceptor) beanFactory.getBean(beanName);</span></span>
<span class="line"><span>            requestInterceptors.add(interceptor);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>registerPgFeignClient();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private void   registerPgFeignClient() {</span></span>
<span class="line"><span>        ClassLoader classLoader = Thread.currentThread().getContextClassLoader();</span></span>
<span class="line"><span>        ClassPathScanningCandidateComponentProvider scanner =getScanner();</span></span>
<span class="line"><span>        scanner.setResourceLoader(this.resourceLoader);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        Set&lt;BeanDefinition&gt; beanDefinitions =new LinkedHashSet&lt;&gt;();</span></span>
<span class="line"><span>for (String pkg : PKG_ARR) {</span></span>
<span class="line"><span>            Set&lt;BeanDefinition&gt; beanDefinitions2 = scanner.findCandidateComponents(pkg);</span></span>
<span class="line"><span>            beanDefinitions.addAll(beanDefinitions2);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>for (BeanDefinition beanDefinition : beanDefinitions) {</span></span>
<span class="line"><span>if (beanDefinition.getBeanClassName() ==null) {</span></span>
<span class="line"><span>continue;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>                beanFactory.getBean(Class.forName(beanDefinition.getBeanClassName()));</span></span>
<span class="line"><span>continue;</span></span>
<span class="line"><span>            } catch (Exception ignored) {</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>                Class&lt;?&gt; aClass = classLoader.loadClass(beanDefinition.getBeanClassName());</span></span>
<span class="line"><span>                PgFeignClient pgFeignClient = aClass.getAnnotation(PgFeignClient.class);</span></span>
<span class="line"><span>if (pgFeignClient ==null) {</span></span>
<span class="line"><span>continue;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// è¿™é‡Œå¹¶æœªå®é™…åˆ›å»ºå¼‚æ­¥å®¢æˆ·ç«¯ï¼Œåç»­è€ƒè™‘å‡çº§</span></span>
<span class="line"><span>//                if (pgFeignClient.async()) {</span></span>
<span class="line"><span>//                    AsyncFeign.AsyncBuilder&lt;?&gt; asyncBuilder = beanFactory.getBean(&quot;asyncFeignBuilder&quot;, AsyncFeign.AsyncBuilder.class);</span></span>
<span class="line"><span>//                }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                Feign.Builder relBuild;</span></span>
<span class="line"><span>switch (pgFeignClient.encoder()) {</span></span>
<span class="line"><span>case GSON:</span></span>
<span class="line"><span>                        relBuild =pgFeignGsonBuild();</span></span>
<span class="line"><span>break;</span></span>
<span class="line"><span>case FORM:</span></span>
<span class="line"><span>                        relBuild =pgFeignFormBuild();</span></span>
<span class="line"><span>break;</span></span>
<span class="line"><span>default:</span></span>
<span class="line"><span>                        relBuild =pgFeignBuild();</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                String url;</span></span>
<span class="line"><span>if (StringUtils.hasText(pgFeignClient.url())) {</span></span>
<span class="line"><span>                    url = pgFeignClient.url();</span></span>
<span class="line"><span>if (url.contains(&quot;${&quot;) &amp;&amp; url.contains(&quot;}&quot;)) {</span></span>
<span class="line"><span>                        url = environment.resolvePlaceholders(pgFeignClient.url());</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if (url.equals(pgFeignClient.url())) {</span></span>
<span class="line"><span>                            url =getUrlByClientCode(pgFeignClient.clientCode(), pgFeignClient.basePath());</span></span>
<span class="line"><span>                        }</span></span>
<span class="line"><span>                    }</span></span>
<span class="line"><span>                } else {</span></span>
<span class="line"><span>                    url =getUrlByClientCode(pgFeignClient.clientCode(), pgFeignClient.basePath());</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// æŒ‡å®š</span></span>
<span class="line"><span>if (pgFeignClient.loadBalance()) {</span></span>
<span class="line"><span>                    relBuild.client(okHttpLoadBalancerClient);</span></span>
<span class="line"><span>                } else {</span></span>
<span class="line"><span>                    relBuild.client(okHttpClient);</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å¦‚æœæ£€æµ‹åˆ°åœ°å€æ˜¯ä¸ªIPï¼Œå¼ºåˆ¶éè´Ÿè½½æ–¹å¼</span></span>
<span class="line"><span>UrlCheck(relBuild, url);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if (!StringUtils.hasText(url)) {</span></span>
<span class="line"><span>                    url =&quot;http://localhost&quot;;</span></span>
<span class="line"><span>                    log.warn(&quot;æ³¨æ„ï¼š{}å®¢æˆ·ç«¯æ— æ³•åŒ¹é…å…·ä½“urlåœ°å€!&quot;, beanDefinition.getBeanClassName());</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                url = PgFeignUtil.doOptimization(url);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>registerBeanDefinition(beanFactory, beanDefinition.getBeanClassName());</span></span>
<span class="line"><span>initConfiguration(relBuild, pgFeignClient.configuration(), pgFeignClient.clientCode());</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                beanFactory.registerSingleton(beanDefinition.getBeanClassName(),</span></span>
<span class="line"><span>                        relBuild.target(aClass, url)</span></span>
<span class="line"><span>                );</span></span>
<span class="line"><span>            } catch (Exception e) {</span></span>
<span class="line"><span>                log.error(&quot;feignåˆå§‹åŒ–å¼‚å¸¸&quot;, e);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private void  UrlCheck(Feign.Builder relBuild, String url) {</span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>            URI uri = URI.create(url);</span></span>
<span class="line"><span>if (isIp(uri.getHost()) ||&quot;localhost&quot;.equals(uri.getHost())) {</span></span>
<span class="line"><span>                relBuild.client(okHttpClient);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        } catch (Exception ignore) {}</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicstaticboolean  isIp(String addr) {</span></span>
<span class="line"><span>if (addr.length() &lt;7|| addr.length() &gt;15) {</span></span>
<span class="line"><span>returnfalse;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        String rexp =&quot;([1-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])(\\.(\\d|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])){3}&quot;;</span></span>
<span class="line"><span>        Pattern pat = Pattern.compile(rexp);</span></span>
<span class="line"><span>        Matcher mat = pat.matcher(addr);</span></span>
<span class="line"><span>return mat.find();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @SneakyThrows</span></span>
<span class="line"><span>private void  initConfiguration(Feign.Builder relBuild, Class&lt;?&gt;[] configuration, String clientCode) {</span></span>
<span class="line"><span>for (Class&lt;?&gt; clazz : configuration) {</span></span>
<span class="line"><span>for (Method method : clazz.getMethods()) {</span></span>
<span class="line"><span>                Bean bean = AnnotatedElementUtils.findMergedAnnotation(method, Bean.class);</span></span>
<span class="line"><span>if (bean ==null) {</span></span>
<span class="line"><span>continue;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                Object ret = bean.value().length ==0?</span></span>
<span class="line"><span>                        beanFactory.getBean(method.getName()) :</span></span>
<span class="line"><span>                        beanFactory.getBean(bean.value()[0]);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pkgFeignBuild(relBuild, method.getReturnType(), ret);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if (FeignUrlCusApi.class.isAssignableFrom(method.getReturnType())) {</span></span>
<span class="line"><span>if (StringUtils.hasText(clientCode)) {</span></span>
<span class="line"><span>                        okHttpCusUrlInterceptor.addFeignUrlCusApi(clientCode, (FeignUrlCusApi) ret);</span></span>
<span class="line"><span>                    }</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private void  pkgFeignBuild(Feign.Builder relBuild, Class&lt;?&gt; returnType, Object ret) {</span></span>
<span class="line"><span>if (Encoder.class.isAssignableFrom(returnType)) {</span></span>
<span class="line"><span>            relBuild.encoder((Encoder) ret);</span></span>
<span class="line"><span>return;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>if (Decoder.class.isAssignableFrom(returnType)) {</span></span>
<span class="line"><span>            relBuild.decoder((Decoder) ret);</span></span>
<span class="line"><span>return;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>if (Contract.class.isAssignableFrom(returnType)) {</span></span>
<span class="line"><span>            relBuild.contract((Contract) ret);</span></span>
<span class="line"><span>return;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>if (Client.class.isAssignableFrom(returnType)) {</span></span>
<span class="line"><span>            relBuild.client((Client) ret);</span></span>
<span class="line"><span>return;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>if (Retryer.class.isAssignableFrom(returnType)) {</span></span>
<span class="line"><span>            relBuild.retryer((Retryer) ret);</span></span>
<span class="line"><span>return;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>if (Request.Options.class.isAssignableFrom(returnType)) {</span></span>
<span class="line"><span>            relBuild.options((Request.Options) ret);</span></span>
<span class="line"><span>return;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>if (RequestInterceptor.class.isAssignableFrom(returnType)) {</span></span>
<span class="line"><span>            relBuild.requestInterceptor((RequestInterceptor) ret);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private String getUrlByClientCode(String clientCode, String basePath) {</span></span>
<span class="line"><span>if (StringUtils.hasText(clientCode)) {</span></span>
<span class="line"><span>if (!this.gateMode) {</span></span>
<span class="line"><span>return&quot;http://&quot;+ clientCode + (StringUtils.hasText(basePath) ?&quot;/&quot;+ basePath :&quot;&quot;);</span></span>
<span class="line"><span>            } else {</span></span>
<span class="line"><span>return centerUrl +&quot;/&quot;+ (StringUtils.hasText(basePath) ? basePath : clientCode);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>return StringUtils.hasText(basePath) ? centerUrl +&quot;/&quot;+ basePath : centerUrl;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>protected ClassPathScanningCandidateComponentProvider getScanner() {</span></span>
<span class="line"><span>returnnewClassPathScanningCandidateComponentProvider(false, this.environment) {</span></span>
<span class="line"><span>            @Override</span></span>
<span class="line"><span>protectedboolean  isCandidateComponent(@NonNull MetadataReader metadataReader) {</span></span>
<span class="line"><span>                Optional&lt;String&gt; target = metadataReader.getAnnotationMetadata().getAnnotationTypes().stream().filter(</span></span>
<span class="line"><span>                        sn -&gt; sn.equals(PgFeignClient.class.getName())</span></span>
<span class="line"><span>                ).findAny();</span></span>
<span class="line"><span>return target.isPresent();</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            @Override</span></span>
<span class="line"><span>protectedboolean  isCandidateComponent(@NonNull AnnotatedBeanDefinition beanDefinition) {</span></span>
<span class="line"><span>return beanDefinition.getMetadata().isInterface() &amp;&amp;!beanDefinition.getMetadata().isAnnotation();</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        };</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private void  registerBeanDefinition(DefaultListableBeanFactory beanFactory, String name) {</span></span>
<span class="line"><span>        BeanDefinitionBuilder beanDefinitionBuilder = BeanDefinitionBuilder.genericBeanDefinition(Binding.class);</span></span>
<span class="line"><span>        beanDefinitionBuilder.addPropertyReference(name, name);</span></span>
<span class="line"><span>        BeanDefinition beanDefinition = beanDefinitionBuilder.getRawBeanDefinition();</span></span>
<span class="line"><span>        beanFactory.registerBeanDefinition(name, beanDefinition);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public Feign.Builder pgFeignBuild() {</span></span>
<span class="line"><span>        Feign.Builder builder =getFeignBuildDefault();</span></span>
<span class="line"><span>buildInterceptors(builder);</span></span>
<span class="line"><span>        String wn = environment.getProperty(&quot;feign.write-nulls&quot;);</span></span>
<span class="line"><span>boolean   writeNulls = StringUtils.hasText(wn) &amp;&amp; boolean  .parseboolean  (wn);</span></span>
<span class="line"><span>// ä½¿ç”¨fastjsonä½œä¸ºfeignçš„æ¶ˆæ¯è½¬æ¢å™¨</span></span>
<span class="line"><span>        ObjectFactory&lt;HttpMessageConverters&gt; feignObjectFactory = PgFeignUtil.initFeignNewConverters(messageConverters, writeNulls);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>return builder</span></span>
<span class="line"><span>                .contract(contract)</span></span>
<span class="line"><span>                .encoder(newSpringEncoder(feignObjectFactory))</span></span>
<span class="line"><span>                .decoder(newSpringDecoder(feignObjectFactory, customizers));</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public Feign.Builder pgFeignGsonBuild() {</span></span>
<span class="line"><span>        Feign.Builder builder =getFeignBuildDefault();</span></span>
<span class="line"><span>buildInterceptors(builder);</span></span>
<span class="line"><span>return builder</span></span>
<span class="line"><span>                .contract(contract)</span></span>
<span class="line"><span>                .encoder(newGsonEncoder())</span></span>
<span class="line"><span>                .decoder(newGsonDecoder());</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public Feign.Builder pgFeignFormBuild() {</span></span>
<span class="line"><span>        Feign.Builder builder =getFeignBuildDefault();</span></span>
<span class="line"><span>buildInterceptors(builder);</span></span>
<span class="line"><span>        String wn = environment.getProperty(&quot;feign.write-nulls&quot;);</span></span>
<span class="line"><span>boolean   writeNulls = StringUtils.hasText(wn) &amp;&amp; boolean  .parseboolean  (wn);</span></span>
<span class="line"><span>// ä½¿ç”¨fastjsonä½œä¸ºfeignçš„æ¶ˆæ¯è½¬æ¢å™¨</span></span>
<span class="line"><span>        ObjectFactory&lt;HttpMessageConverters&gt; feignObjectFactory = PgFeignUtil.initFeignNewConverters(messageConverters, writeNulls);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>return builder</span></span>
<span class="line"><span>                .contract(contract)</span></span>
<span class="line"><span>                .encoder(newSpringFormEncoder(newSpringEncoder(feignObjectFactory)))</span></span>
<span class="line"><span>                .decoder(newSpringDecoder(feignObjectFactory, customizers));</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private Feign.Builder getFeignBuildDefault() {</span></span>
<span class="line"><span>// å› ä¸ºscopeä¸ºprototypeï¼Œæ¯æ¬¡è·å–beanéƒ½ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡</span></span>
<span class="line"><span>return beanFactory.getBean(&quot;feignBuilder&quot;, Feign.Builder.class);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private void  buildInterceptors(Feign.Builder builder) {</span></span>
<span class="line"><span>// ä¸ç›´æ¥ä½¿ç”¨builder.requestInterceptorsæ–¹æ³•çš„åŸå› æ˜¯è¿™ä¸ªæ–¹æ³•ä¼šæ¸…ç©ºåŸæœ‰æ‹¦æˆªå™¨</span></span>
<span class="line"><span>for (RequestInterceptor requestInterceptor : requestInterceptors) {</span></span>
<span class="line"><span>            builder.requestInterceptor(requestInterceptor);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    ä¸»è¦ç»™feignå®¢æˆ·ç«¯é…ç½®äº†å„ç±»æ‹¦æˆªç¼–ç åŠå“åº”å€¼è§£ææ‰€éœ€ç¼“å­˜ï¼ˆå› ä¸ºfeignçš„å›è°ƒé’©å­</span></span>
<span class="line"><span>ä¸Šä¸‹æ–‡ä¸­æ— æ³•è·å–åˆ°æ‰§è¡Œçš„æ–¹æ³•ä¸Šä¸‹æ–‡ï¼Œä¹Ÿå°±æ— æ³•çŸ¥é“ä½¿ç”¨å“ªä¸ªå€¼è½¬æ¢ç±»ï¼Œæ‰€ä»¥éœ€è¦æå‰ç¼“å­˜å¥½ï¼‰ã€‚</span></span>
<span class="line"><span>ä¸»è¦ä½¿ç”¨äº†åå°„ã€‚æ­¤æ—¶å®¢æˆ·ç«¯å·²ç»ç”Ÿæˆã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>package com.kingtsoft.pangu.springcloud.feign;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import com.kingtsoft.pangu.springcloud.feign.annotation.FeignResultClient;</span></span>
<span class="line"><span>import com.kingtsoft.pangu.springcloud.feign.annotation.PgFeignClient;</span></span>
<span class="line"><span>import com.kingtsoft.pangu.springcloud.feign.utils.PgFeignUtil;</span></span>
<span class="line"><span>import org.springframework.beans.BeansException;</span></span>
<span class="line"><span>import org.springframework.context.ApplicationContext;</span></span>
<span class="line"><span>import org.springframework.context.ApplicationContextAware;</span></span>
<span class="line"><span>import org.springframework.core.annotation.AnnotatedElementUtils;</span></span>
<span class="line"><span>import org.springframework.lang.NonNull;</span></span>
<span class="line"><span>import org.springframework.stereotype.Component;</span></span>
<span class="line"><span>import org.springframework.util.StringUtils;</span></span>
<span class="line"><span>import org.springframework.web.bind.annotation.RequestMapping;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import java.lang.reflect.*;</span></span>
<span class="line"><span>import java.net.URI;</span></span>
<span class="line"><span>import java.util.HashMap;</span></span>
<span class="line"><span>import java.util.Map;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Title: &lt;br&gt;</span></span>
<span class="line"><span> * Description: &lt;br&gt;</span></span>
<span class="line"><span> * Company: KingTang &lt;br&gt;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * @author é‡‘ç‚€</span></span>
<span class="line"><span> * @version 1.0</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>@Component</span></span>
<span class="line"><span>public class  FeignResultCoverRegisterimplementsApplicationContextAware {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private final   Map&lt;String, FeignResultCover&gt; feignResultCache =new HashMap&lt;&gt;();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private ApplicationContext applicationContext;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   setApplicationContext(@NonNull ApplicationContext applicationContext) throws BeansException {</span></span>
<span class="line"><span>this.applicationContext = applicationContext;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private void   registerFeignResultCover() {</span></span>
<span class="line"><span>        Map&lt;String, Object&gt; feignResultBeans = applicationContext.getBeansWithAnnotation(PgFeignClient.class);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        feignResultBeans.forEach(</span></span>
<span class="line"><span>                (beanName, bean) -&gt; {</span></span>
<span class="line"><span>if (Proxy.isProxyClass(bean.getClass())) {</span></span>
<span class="line"><span>                        Object obj = Proxy.getInvocationHandler(bean);</span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>                            Field targetField = obj.getClass().getDeclaredField(&quot;target&quot;);</span></span>
<span class="line"><span>                            targetField.setAccessible(true);</span></span>
<span class="line"><span>                            Object target = targetField.get(obj);</span></span>
<span class="line"><span>if (target ==null) {</span></span>
<span class="line"><span>thrownewRuntimeException(&quot;ä»£ç† targetå±æ€§ç¼ºå¤±: &quot;+ obj.getClass().getName());</span></span>
<span class="line"><span>                            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                            Field urlField = target.getClass().getDeclaredField(&quot;url&quot;);</span></span>
<span class="line"><span>                            urlField.setAccessible(true);</span></span>
<span class="line"><span>                            String reqUrl = (String) urlField.get(target);</span></span>
<span class="line"><span>if (reqUrl ==null) {</span></span>
<span class="line"><span>                                reqUrl =&quot;&quot;;</span></span>
<span class="line"><span>                            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                            Field typeField = target.getClass().getDeclaredField(&quot;type&quot;);</span></span>
<span class="line"><span>                            typeField.setAccessible(true);</span></span>
<span class="line"><span>                            Class&lt;?&gt; type = (Class&lt;?&gt;) typeField.get(target);</span></span>
<span class="line"><span>if (type ==null) {</span></span>
<span class="line"><span>thrownewRuntimeException(&quot;typeå±æ€§ç¼ºå¤±: &quot;+ target.getClass().getName());</span></span>
<span class="line"><span>                            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                            PgFeignClient client = type.getAnnotation(PgFeignClient.class);</span></span>
<span class="line"><span>if (client !=null&amp;&amp;!StringUtils.hasText(reqUrl)) {</span></span>
<span class="line"><span>                                reqUrl = client.clientCode();</span></span>
<span class="line"><span>                            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                            FeignResultClient parentAnnotation = type.getAnnotation(FeignResultClient.class);</span></span>
<span class="line"><span>                            FeignResultCover parentResultCover =null;</span></span>
<span class="line"><span>if (parentAnnotation !=null) {</span></span>
<span class="line"><span>                                parentResultCover =</span></span>
<span class="line"><span>newFeignResultCover(parentAnnotation.value(), parentAnnotation.coverMethod(), null);</span></span>
<span class="line"><span>                            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>String[] parentUrls =getMethodUrl(type);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Method[] methods = type.getDeclaredMethods();</span></span>
<span class="line"><span>for (Method method : methods) {</span></span>
<span class="line"><span>                                FeignResultClient annotation = method.getAnnotation(FeignResultClient.class);</span></span>
<span class="line"><span>                                FeignResultCover resultCover;</span></span>
<span class="line"><span>                                String postfix;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if (annotation !=null) {</span></span>
<span class="line"><span>                                    postfix = annotation.postfix();</span></span>
<span class="line"><span>                                    resultCover =newFeignResultCover(</span></span>
<span class="line"><span>                                            annotation.value(), annotation.coverMethod(), method.getReturnType());</span></span>
<span class="line"><span>                                } else {</span></span>
<span class="line"><span>                                    postfix =&quot;&quot;;</span></span>
<span class="line"><span>if (parentResultCover ==null) {</span></span>
<span class="line"><span>continue;</span></span>
<span class="line"><span>                                    }</span></span>
<span class="line"><span>                                    resultCover =newFeignResultCover(</span></span>
<span class="line"><span>                                            parentResultCover.getCoverClazz(),</span></span>
<span class="line"><span>                                            parentResultCover.getCoverMethod(),</span></span>
<span class="line"><span>                                            method.getReturnType());</span></span>
<span class="line"><span>                                }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>String[] urls =getMethodUrl(method);</span></span>
<span class="line"><span>if (method.getParameterTypes().length !=0&amp;&amp; method.getParameterTypes()[0].equals(URI.class)) {</span></span>
<span class="line"><span>if (urls !=null) {</span></span>
<span class="line"><span>for (String url : urls) {</span></span>
<span class="line"><span>                                            feignResultCache.put(PgFeignUtil.doOptimization(&quot;**/&quot;+ url + postfix), resultCover);</span></span>
<span class="line"><span>                                        }</span></span>
<span class="line"><span>                                    } else {</span></span>
<span class="line"><span>                                        feignResultCache.put(PgFeignUtil.doOptimization(&quot;**/&quot;+ postfix), resultCover);</span></span>
<span class="line"><span>                                    }</span></span>
<span class="line"><span>                                } else {</span></span>
<span class="line"><span>if (parentUrls ==null|| parentUrls.length ==0) {</span></span>
<span class="line"><span>if (urls !=null) {</span></span>
<span class="line"><span>for (String url : urls) {</span></span>
<span class="line"><span>                                                feignResultCache.put(PgFeignUtil.doOptimization(reqUrl + url + postfix), resultCover);</span></span>
<span class="line"><span>                                            }</span></span>
<span class="line"><span>                                        }</span></span>
<span class="line"><span>                                    } else {</span></span>
<span class="line"><span>for (String parentUrl : parentUrls) {</span></span>
<span class="line"><span>if (urls !=null) {</span></span>
<span class="line"><span>for (String url : urls) {</span></span>
<span class="line"><span>                                                    feignResultCache.put(PgFeignUtil.doOptimization(reqUrl + parentUrl + url + postfix), resultCover);</span></span>
<span class="line"><span>                                                }</span></span>
<span class="line"><span>                                            } else {</span></span>
<span class="line"><span>                                                feignResultCache.put(PgFeignUtil.doOptimization(reqUrl + parentUrl + postfix), resultCover);</span></span>
<span class="line"><span>                                            }</span></span>
<span class="line"><span>                                        }</span></span>
<span class="line"><span>                                    }</span></span>
<span class="line"><span>                                }</span></span>
<span class="line"><span>                            }</span></span>
<span class="line"><span>                        } catch (Exception e) {</span></span>
<span class="line"><span>                            e.printStackTrace();</span></span>
<span class="line"><span>                        }</span></span>
<span class="line"><span>                    }</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>        );</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public Map&lt;String, FeignResultCover&gt; getFeignResultCache() {</span></span>
<span class="line"><span>returnthis.feignResultCache;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>privateString[] getMethodUrl(AnnotatedElement element) {</span></span>
<span class="line"><span>        RequestMapping requestMapping = AnnotatedElementUtils.findMergedAnnotation(element, RequestMapping.class);</span></span>
<span class="line"><span>if (requestMapping !=null) {</span></span>
<span class="line"><span>return requestMapping.value();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>returnnull;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    é€šè¿‡ç¼“å­˜ï¼ŒåŠ å…¥äº†è‡ªåŠ¨å¯¹jsonresultçš„æ•°æ®è§£æåŠå†…å®¹åˆ¤å®šï¼Œåœ¨è°ƒç”¨åŠå®šä¹‰çš„æ—¶å€™å¯ä»¥ç›´æ¥å®šä¹‰</span></span>
<span class="line"><span>ç»“æ„ä½“dataå†…çš„æ•°æ®ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½å†™æ˜¾ç¤ºçš„ä»£ç ï¼Œå¯¹å†…å®¹è¿›è¡Œè§£æã€‚å½“ç„¶å¹¶ä¸æ˜¯æ‰€æœ‰æ¥å£éƒ½ä¸€å®šéœ€è¦</span></span>
<span class="line"><span>è§£æç»“æ„ä½“ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªFeignResultClientæ³¨è§£ï¼Œæ ‡è®°æ­¤ç±»å®¢æˆ·ç«¯(ä¸åŒç»“æ„ä½“çš„è§£æå™¨æ˜¯å¯ä»¥</span></span>
<span class="line"><span>è‡ªå®šä¹‰çš„ï¼Œå¹¶é…ç½®åˆ°FeignResultClientä¸­)ã€‚æ‹¦æˆªå™¨è§£æå¦‚ä¸‹ï¼š</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>@Override</span></span>
<span class="line"><span>    @NonNull</span></span>
<span class="line"><span>public Response intercept(Chain chain) throws IOException {</span></span>
<span class="line"><span>//è¿™ä¸ªchainé‡Œé¢åŒ…å«äº†requestå’Œresponseï¼Œæ‰€ä»¥ä½ è¦ä»€ä¹ˆéƒ½å¯ä»¥ä»è¿™é‡Œæ‹¿</span></span>
<span class="line"><span>        Request request = chain.request();</span></span>
<span class="line"><span>//è¯·æ±‚å‘èµ·çš„æ—¶é—´</span></span>
<span class="line"><span>        Response response = chain.proceed(request);</span></span>
<span class="line"><span>if (response.code() &gt;=400) {</span></span>
<span class="line"><span>            String msg = StringUtils.hasText(response.message()) ?</span></span>
<span class="line"><span>                    response.message() :</span></span>
<span class="line"><span>                    (response.body() ==null?&quot;&quot;: response.body().string());</span></span>
<span class="line"><span>if (log.isDebugEnabled()) {</span></span>
<span class="line"><span>                log.debug(&quot;code: {} msg: {}&quot;, response.code(), msg);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>thrownewTipException(response.code(), msg);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        ResponseBody body = response.body();</span></span>
<span class="line"><span>if (body ==null) {</span></span>
<span class="line"><span>return response;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        FeignResultCover resultCover =getFeignResultCover(request.url().toString());</span></span>
<span class="line"><span>if (resultCover ==null) {</span></span>
<span class="line"><span>return response;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        String ret = body.string();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        Class&lt;?&gt; clazz = resultCover.getCoverClazz();</span></span>
<span class="line"><span>        Method method;</span></span>
<span class="line"><span>        Object obj;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>            method = clazz.getMethod(resultCover.getCoverMethod(), Object.class);</span></span>
<span class="line"><span>            obj = method.invoke(clazz.getDeclaredConstructor().newInstance(), ret);</span></span>
<span class="line"><span>        } catch (InvocationTargetException e) {</span></span>
<span class="line"><span>if (log.isDebugEnabled()) {</span></span>
<span class="line"><span>                e.printStackTrace();</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            Throwable exception = e.getTargetException();</span></span>
<span class="line"><span>if (exception instanceof TipException) {</span></span>
<span class="line"><span>throw (TipException) exception;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>thrownewTipException(e.toString());</span></span>
<span class="line"><span>        } catch (NoSuchMethodException | IllegalAccessException | InstantiationException e) {</span></span>
<span class="line"><span>if (log.isDebugEnabled()) {</span></span>
<span class="line"><span>                e.printStackTrace();</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>thrownewTipException(e.toString());</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        ResponseBody bodyNew;</span></span>
<span class="line"><span>        String bkObj;</span></span>
<span class="line"><span>if (obj ==null) {</span></span>
<span class="line"><span>            bkObj =&quot;null&quot;;</span></span>
<span class="line"><span>        } elseif (obj.getClass().equals(String.class)) {</span></span>
<span class="line"><span>// ä¼šä½¿ç”¨æ¶ˆæ¯è½¬æ¢å™¨åˆ‡æ¢å›æ¥</span></span>
<span class="line"><span>            bkObj = JSON.toJSONString(obj);</span></span>
<span class="line"><span>        } else {</span></span>
<span class="line"><span>            bkObj = JSON.toJSONString(obj);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        bodyNew = ResponseBody.create(body.contentType(), bkObj);</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>return response.newBuilder().body(bodyNew).build();</span></span>
<span class="line"><span>    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    æ”¯æŒæœåŠ¡è‡ªå®šä¹‰ä»£ç è¿”å›åœ°å€ï¼ˆç”¨äºä¸‰æ–¹ï¼Œå¯èƒ½éœ€è¦æ•°æ®åº“åŠ¨æ€å®æ—¶è·å–ï¼‰ï¼ŒåŸç†æ˜¯åˆ©ç”¨æ‹¦æˆªå™¨</span></span>
<span class="line"><span>å¯¹requestè¿›è¡Œåœ°å€æˆªå–å¹¶å¡«å……æ–°æ•°æ®ã€‚ä¸šåŠ¡ç«¯å®ç°FeignUrlCusApiæ¥å£ï¼Œé‡å†™æ–¹æ³•å°±è¡Œã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>public class  OkHttpCusUrlInterceptorimplementsInterceptor {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private final   Map&lt;String, FeignUrlCusApi&gt; urlCusApis =new LinkedHashMap&lt;&gt;();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private void   addFeignUrlCusApi(String serviceId, FeignUrlCusApi feignUrlCusApi) {</span></span>
<span class="line"><span>this.urlCusApis.put(serviceId, feignUrlCusApi);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @NonNull</span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>public Response intercept(@NonNull Chain chain) throws IOException {</span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>            String path = chain.request().url().encodedPath();</span></span>
<span class="line"><span>            Request request = chain.request();</span></span>
<span class="line"><span>            FeignUrlCusApi urlCusApi = urlCusApis.get(request.url().host());</span></span>
<span class="line"><span>if (urlCusApi ==null) {</span></span>
<span class="line"><span>return chain.proceed(request);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            String url = urlCusApi.getUrl();</span></span>
<span class="line"><span>if (!StringUtils.hasText(url)) {</span></span>
<span class="line"><span>return chain.proceed(request);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            HttpUrl httpUrl = Objects.requireNonNull(request.url().newBuilder(url + path))</span></span>
<span class="line"><span>                    .query(request.url().query())</span></span>
<span class="line"><span>                    .encodedQuery(request.url().encodedQuery())</span></span>
<span class="line"><span>                    .fragment(request.url().fragment())</span></span>
<span class="line"><span>                    .encodedFragment(request.url().encodedFragment())</span></span>
<span class="line"><span>                    .build();</span></span>
<span class="line"><span>return chain.proceed(request.newBuilder().url(httpUrl).build());</span></span>
<span class="line"><span>        } catch (Exception e) {</span></span>
<span class="line"><span>            log.error(e.toString());</span></span>
<span class="line"><span>return chain.proceed(chain.request());</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>Feign-javaè°ƒç”¨å…¼å®¹</span></span>
<span class="line"><span>    æ·»åŠ äº†feign APIçš„spring beanåˆ¤æ–­ï¼Œè‹¥å½“å‰æ¥å£ä¸­å­˜åœ¨å¯¹åº”çš„å®ç°ï¼Œå°†ä¸ä¼šå¯¹æ­¤æ¥å£è¿›è¡Œ</span></span>
<span class="line"><span>feignå®¢æˆ·ç«¯çš„ä»£ç†ç”Ÿæˆï¼Œå¸¸è§„çš„æ¥å£è°ƒç”¨å°†å˜æˆè¿›ç¨‹å†…çš„ç›´æ¥è°ƒç”¨ã€è‡ªç„¶å¯ä»¥ä¿æŒç›´æ¥çš„äº‹åŠ¡ä¸€è‡´ã€‘ã€‚</span></span>
<span class="line"><span>è‹¥ä¸å­˜åœ¨å®ç°ï¼Œåˆ™æ¥å£å°±ä¼šæ‰§è¡Œæ³¨è§£æ‰€ç¤ºçš„feignè°ƒç”¨ã€‚è¿™ä¸ªæ—¶å€™å°±ä¼šéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ã€‚ æ¥å£æ‰€å¤„</span></span>
<span class="line"><span>ç›®å½•è¦ä¹ˆåŒ…åå¸¦feignï¼Œè¦ä¹ˆå¸¦apiå…³é”®å­—</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://pangu.kingtsoft.com/pangu-facade/assets/image1.8ca381d0.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>è´Ÿè½½å‡è¡¡</span></span>
<span class="line"><span>    å›åˆ°è‡ªåŠ¨åŒ–é…ç½®ç±»åˆå§‹åŒ–å†…å®¹FeignAutoConfiguration</span></span>
<span class="line"><span>    å¯ä»¥çœ‹åˆ°é…ç½®äº†</span></span>
<span class="line"><span>@AutoConfigureAfter(name = {&quot;com.kingtsoft.pangu.springcloud.nacos.NacosAutoConfiguration&quot;})ï¼Œ</span></span>
<span class="line"><span>    ä¸»è¦æ˜¯ç»“åˆnacosæ¨¡å—ï¼Œç”±äºéœ€è¦å¼•å…¥è‡ªå®šä¹‰çš„loadbalanceæ¨¡å—è¿›è¡Œå µåœ¨å‡è¡¡è‡ªå®šä¹‰ç®—æ³•æ‰§è¡Œã€‚</span></span>
<span class="line"><span>æ‰€ä»¥éœ€è¦åœ¨NacosAutoConfigurationé…ç½®è´Ÿè½½å®¢æˆ·ç«¯ä¹‹ååŠ è½½ï¼Œå› ä¸ºæ˜¯å­—ç¬¦ä¸²å¼•å…¥ï¼Œæ‰€ä»¥ä¸¤ä¸ª</span></span>
<span class="line"><span>æ¨¡å—ä¸æ˜¯å¼ºè€¦åˆçš„ï¼Œå¦‚æœæ²¡æœ‰LoadBalancerClientFactory ä¸­çš„configurationsåªæ˜¯æ²¡æœ‰</span></span>
<span class="line"><span>äº†è‡ªå®šä¹‰çš„è´Ÿè½½å®ç°ï¼Œä¼šèµ°é»˜è®¤ã€‚NacosAutoConfigurationå…ˆæ‰§è¡Œå°±æ˜¯ä¸ºäº†è®©</span></span>
<span class="line"><span>LoadBalancerClientFactoryå¯ä»¥æå‰å¾€configurationsæ³¨å…¥è‡ªå®šä¹‰çš„å®ç°ã€‚okHttpçš„è´Ÿ</span></span>
<span class="line"><span>è½½å®¢æˆ·ç«¯è¿™é‡Œç›´æ¥é»˜è®¤ä½¿ç”¨äº†BlockingLoadBalancerClientï¼ŒLoadBalancerClientFactory</span></span>
<span class="line"><span>çš„åˆå§‹éƒ½å‚è€ƒæºç å†…å®¹ã€‚å¹¶ä¸”å¼€æ”¾äº†é›†ç¾¤æ ‡è®°é…ç½®ï¼Œè¿™æ ·åœ¨æ²¡æœ‰ç½‘å…³çš„æƒ…å†µä¸‹ï¼Œfeignä¹Ÿèƒ½ç‹¬ç«‹å®Œæˆ</span></span>
<span class="line"><span>æµé‡çš„å¼•å¯¼ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/Todreamr/Dr.Magic/edit/main/src/ç›˜å¤/ç»„ä»¶ä»‹ç»/ç›˜å¤-security.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: aruixrain@gmail.com">ä¹æ­Œå¤©ä¸Šæœ‰</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E5%BB%B6%E6%97%B6%E6%A8%A1%E5%9D%97.html" aria-label="Delayæ¨¡å—"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Delayæ¨¡å—</div></a><a class="route-link auto-link next" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/Https%E6%A8%A1%E5%9D%97.html" aria-label="Httpsæ¨¡å—"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Httpsæ¨¡å—<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">ç”±èŒICPå¤‡æ¡ˆ</div><div class="vp-copyright">Copyright Â© Mr.Cotton Eye Joe</div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-TmqSDitQ.js" defer></script>
  </body>
</html>
