<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/chat%E6%A8%A1%E5%9D%97.html"><meta property="og:title" content="chatæ¨¡å—"><meta property="og:description" content="chatæ¨¡å— å¦‚ä½•ä½¿ç”¨ xml xml java java yaml yaml typescript image.pngimage.png æŠ€æœ¯åŸç† image.pngimage.png pangu-frame-chat chatä¸šåŠ¡å¼•ç”¨æ¨¡å—ï¼ˆå¯ä»¥å½“å®¢æˆ·ç«¯ï¼‰ pangu-frame-chat-common chatæ ‡å‡†å¸¸é‡åŠæ•°æ®ç»“æ„ pangu-fra..."><meta property="og:type" content="article"><meta property="og:image" content="http://pangu.kingtsoft.com/pangu-facade/assets/image1.b1f66964.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-11-18T07:25:41.000Z"><meta property="article:author" content="Cotton Eye Joe"><meta property="article:modified_time" content="2024-11-18T07:25:41.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"chatæ¨¡å—","image":["http://pangu.kingtsoft.com/pangu-facade/assets/image1.b1f66964.png","http://pangu.kingtsoft.com/pangu-facade/assets/image2.f652bd0d.jpg"],"dateModified":"2024-11-18T07:25:41.000Z","author":[{"@type":"Person","name":"Cotton Eye Joe","url":"https://github.com/ToDreamr"}]}</script><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><script async src="https://umami.zhenxin.me/script.js" data-website-id="a799e189-cf7e-4f5a-ac98-71de364f3637"></script><script src="https://cdn.armoe.cn/static/js/autoGray.js"></script><title>chatæ¨¡å—</title><meta name="description" content="chatæ¨¡å— å¦‚ä½•ä½¿ç”¨ xml xml java java yaml yaml typescript image.pngimage.png æŠ€æœ¯åŸç† image.pngimage.png pangu-frame-chat chatä¸šåŠ¡å¼•ç”¨æ¨¡å—ï¼ˆå¯ä»¥å½“å®¢æˆ·ç«¯ï¼‰ pangu-frame-chat-common chatæ ‡å‡†å¸¸é‡åŠæ•°æ®ç»“æ„ pangu-fra...">
    <link rel="preload" href="/assets/style-DuvwdHTW.css" as="style"><link rel="stylesheet" href="/assets/style-DuvwdHTW.css">
    <link rel="modulepreload" href="/assets/app-DGcq1nYR.js"><link rel="modulepreload" href="/assets/chatæ¨¡å—.html-AcvQjDq5.js">
    <link rel="prefetch" href="/assets/index.html-Cxi0qDeh.js" as="script"><link rel="prefetch" href="/assets/portfolio.html-BpAAyR0u.js" as="script"><link rel="prefetch" href="/assets/å‹é“¾.html-CEP2zPUC.js" as="script"><link rel="prefetch" href="/assets/index.html-C_rh8yMu.js" as="script"><link rel="prefetch" href="/assets/disable.html-CuX3bDal.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-DSpxwSgu.js" as="script"><link rel="prefetch" href="/assets/layout.html-Bb_O4UiO.js" as="script"><link rel="prefetch" href="/assets/markdown.html-CFktBkml.js" as="script"><link rel="prefetch" href="/assets/page.html-DEk3J_gk.js" as="script"><link rel="prefetch" href="/assets/å‹é“¾.html-o-liZiBo.js" as="script"><link rel="prefetch" href="/assets/index.html-CmOLNL1Q.js" as="script"><link rel="prefetch" href="/assets/index.html-CBBETW8M.js" as="script"><link rel="prefetch" href="/assets/Otome Games Analysis.html-C-wY4ie3.js" as="script"><link rel="prefetch" href="/assets/åœ¨ç”Ÿæ´»ä¸­çš„ä¸€äº›æ€è€ƒé—®é¢˜.html-BX-rfWbr.js" as="script"><link rel="prefetch" href="/assets/å­¦ä¹ è®¡åˆ’.html-BjYKgkdb.js" as="script"><link rel="prefetch" href="/assets/Idea.html-RhilFI4c.js" as="script"><link rel="prefetch" href="/assets/10æœˆ.html-CYG5Nqlw.js" as="script"><link rel="prefetch" href="/assets/ä¾èµ–ç›¸å…³.html-yBCvDhoC.js" as="script"><link rel="prefetch" href="/assets/word.html-C-unRWio.js" as="script"><link rel="prefetch" href="/assets/æ•°å­—é©¬åŠ›.html-BnvWcKOA.js" as="script"><link rel="prefetch" href="/assets/7.0ç—…å†.html-BxUwCuHO.js" as="script"><link rel="prefetch" href="/assets/Oracleæ•°æ®åº“éƒ¨åˆ†ä»£ç æµ‹è¯•ä¸é€šè¿‡.html-DCUBaM6e.js" as="script"><link rel="prefetch" href="/assets/SQLæ—¥å¿—æ’æŸ¥è®°å½•çš„å·¥ä½œæµç¨‹.html-Ber0mLzT.js" as="script"><link rel="prefetch" href="/assets/kemerç—…å†éƒ¨æ¶æ„æ•´ç†.html-DE-SbBC9.js" as="script"><link rel="prefetch" href="/assets/äº‹åŠ¡åˆ†æ.html-CwtEObdh.js" as="script"><link rel="prefetch" href="/assets/å¦‚ä½•åœ¨å·¥ä½œå½“ä¸­ä¹¦å†™éœ€è¦çš„SQL.html-CG9tAlDA.js" as="script"><link rel="prefetch" href="/assets/å·¥ä½œæµç¨‹.html-mGuW1xXJ.js" as="script"><link rel="prefetch" href="/assets/å¼€å‘è§„èŒƒå’ŒçŸ¥è¯†æ–‡æ¡£.html-CpRd2W8D.js" as="script"><link rel="prefetch" href="/assets/å¼‚å¸¸SQLæ•°æ®æŸ¥è¯¢.html-BRpcIho-.js" as="script"><link rel="prefetch" href="/assets/è´¨æ§é¡¹-ä¿®æ”¹ä»£ç (SQL).html-pNnmsOXM.js" as="script"><link rel="prefetch" href="/assets/é‡‘å”è½¯ä»¶.html-DlQQbQZu.js" as="script"><link rel="prefetch" href="/assets/é‡‘å”è½¯ä»¶éƒ¨åˆ†ä»£ç åˆ†æ.html-hWlQicvN.js" as="script"><link rel="prefetch" href="/assets/Ubuntuç³»ç»Ÿå„è½¯ä»¶.html-DygGaVPf.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ.html-Bn9vtmeD.js" as="script"><link rel="prefetch" href="/assets/ç—…å†-ä¸´åºŠéƒ¨é—¨åç«¯å®ä¹ .html-DSwg7JNJ.js" as="script"><link rel="prefetch" href="/assets/é«˜å¹¶å‘ç¼–ç¨‹.html-DEKEv1u5.js" as="script"><link rel="prefetch" href="/assets/JVMå†…å­˜æ¨¡å‹.html-BEMWHA_v.js" as="script"><link rel="prefetch" href="/assets/å†…å­˜ç®¡ç†.html-ByEDrvOc.js" as="script"><link rel="prefetch" href="/assets/ç±»ä¸ç±»åŠ è½½.html-0UYmGtyZ.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼ç³»åˆ— - è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™.html-DZMZ3YGZ.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼ç³»åˆ— - è®¾è®¡æ¨¡å¼ï¼ˆä¸‰ï¼‰ç»“æ„å‹.html-CC7ID7md.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼ç³»åˆ— - è®¾è®¡æ¨¡å¼ï¼ˆäºŒï¼‰åˆ›å»ºå‹.html-zQTsamKu.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼ç³»åˆ— - è®¾è®¡æ¨¡å¼ï¼ˆå››ï¼‰è¡Œä¸ºå‹.html-BSLE-2eE.js" as="script"><link rel="prefetch" href="/assets/Cpp.html-C-3HQqTS.js" as="script"><link rel="prefetch" href="/assets/index.html-wV6dqMpR.js" as="script"><link rel="prefetch" href="/assets/baz.html-CC1LMErU.js" as="script"><link rel="prefetch" href="/assets/index.html-B-N10g6U.js" as="script"><link rel="prefetch" href="/assets/ray.html-nBKyLfUA.js" as="script"><link rel="prefetch" href="/assets/KafKa.html-0RILYfiK.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ.html-fh75bXut.js" as="script"><link rel="prefetch" href="/assets/Redis(æ¶ˆæ¯æ¨¡å¼).html-C-azFGYp.js" as="script"><link rel="prefetch" href="/assets/Redis(ç›´è¿æ¨¡å¼).html-ChN6bznx.js" as="script"><link rel="prefetch" href="/assets/minio.html-DjUy2gRM.js" as="script"><link rel="prefetch" href="/assets/mongodb.html-D_qfW185.js" as="script"><link rel="prefetch" href="/assets/nacosé›†æˆ.html-Cwh-1xCK.js" as="script"><link rel="prefetch" href="/assets/ESæ¨¡å—.html-CaKrxqCt.js" as="script"><link rel="prefetch" href="/assets/Prometheusæ¨¡å—.html-C8VRhHrx.js" as="script"><link rel="prefetch" href="/assets/shardingæ¨¡å—.html-CuqR-Vtp.js" as="script"><link rel="prefetch" href="/assets/åˆ†å¸ƒå¼äº‹åŠ¡ç³»åˆ—.html-ZzJzHbBs.js" as="script"><link rel="prefetch" href="/assets/å¤šçº¿ç¨‹äº‹åŠ¡.html-RP_16fRo.js" as="script"><link rel="prefetch" href="/assets/æ•°æ®æºæ¨¡å—.html-DnO88qsB.js" as="script"><link rel="prefetch" href="/assets/Httpsæ¨¡å—.html-B7QnfiuY.js" as="script"><link rel="prefetch" href="/assets/Mybatis-Plus.html-B7GUB3Wr.js" as="script"><link rel="prefetch" href="/assets/SQLè·Ÿè¸ªæ¨¡å—.html-DZvKFu20.js" as="script"><link rel="prefetch" href="/assets/Swagger.html-B9ljXq82.js" as="script"><link rel="prefetch" href="/assets/listå·¥ä½œæµé›†æˆ.html-zX_oRc--.js" as="script"><link rel="prefetch" href="/assets/plugç»„ä»¶.html-PE8wLZiA.js" as="script"><link rel="prefetch" href="/assets/xxl-jobæ¨¡å—.html-7blqZITh.js" as="script"><link rel="prefetch" href="/assets/ä»“ç›’æ¨¡å—.html-VNcXtvH8.js" as="script"><link rel="prefetch" href="/assets/å·¥å…·ç±».html-PWT78G7y.js" as="script"><link rel="prefetch" href="/assets/å»¶æ—¶æ¨¡å—.html-B_NeTaLO.js" as="script"><link rel="prefetch" href="/assets/å¼‚å¸¸æ¨¡å—.html-BrKx8XcR.js" as="script"><link rel="prefetch" href="/assets/æ§åˆ¶å™¨æ’é™¤æ¨¡å—.html-DTTgXlJB.js" as="script"><link rel="prefetch" href="/assets/æ¡†æ¶æ—¥å¿—æ¨¡å—.html-DwfWXbgn.js" as="script"><link rel="prefetch" href="/assets/ç›˜å¤-security.html-DXD11Blz.js" as="script"><link rel="prefetch" href="/assets/ç›˜å¤.html-CChG2eoB.js" as="script"><link rel="prefetch" href="/assets/ç›˜å¤securityæ¨¡å—(å«æˆæƒ).html-CS0BvvD1.js" as="script"><link rel="prefetch" href="/assets/ç¼“å­˜æ¨¡å—.html-CQ_ntj9-.js" as="script"><link rel="prefetch" href="/assets/è„±æ•å’ŒæŒä¹…å±‚åŠ è§£å¯†.html-CC-d3vR6.js" as="script"><link rel="prefetch" href="/assets/è®¤è¯æ¨¡å—.html-BjyXHJc3.js" as="script"><link rel="prefetch" href="/assets/é…ç½®æ–‡ä»¶åŠ è§£å¯†æ¨¡å—.html-BLvEpqcO.js" as="script"><link rel="prefetch" href="/assets/nacos.html-DG-c7s7M.js" as="script"><link rel="prefetch" href="/assets/æ—¥å¿—.html-CPoQqPvR.js" as="script"><link rel="prefetch" href="/assets/ç†”æ–­.html-DYnFzy-9.js" as="script"><link rel="prefetch" href="/assets/è®¤è¯.html-CMc_ASX4.js" as="script"><link rel="prefetch" href="/assets/è·¯ç”±.html-BM36XWGA.js" as="script"><link rel="prefetch" href="/assets/é™æµ.html-BW6QYYzT.js" as="script"><link rel="prefetch" href="/assets/é€šç”¨é“¾è·¯è·Ÿè¸ªæ¨¡å—.html-_Y5qYacD.js" as="script"><link rel="prefetch" href="/assets/é¹°çœ¼æ¨¡å—.html-CVP3LjQ-.js" as="script"><link rel="prefetch" href="/assets/index.html-BPYdcZSK.js" as="script"><link rel="prefetch" href="/assets/index.html-BKLk5ved.js" as="script"><link rel="prefetch" href="/assets/å¹¶å‘ç¼–ç¨‹.html-BTLOt8bS.js" as="script"><link rel="prefetch" href="/assets/ç±»å›¾-UML.html-v6Y6VCwv.js" as="script"><link rel="prefetch" href="/assets/SpringCloud 1.html-DOiFTN8f.js" as="script"><link rel="prefetch" href="/assets/SpringCloud 2.html-CkqqMLFi.js" as="script"><link rel="prefetch" href="/assets/SpringCloud 3.html-DC5GdcSf.js" as="script"><link rel="prefetch" href="/assets/index.html-VFJJWR7E.js" as="script"><link rel="prefetch" href="/assets/MySQL.html-DWBSm2LA.js" as="script"><link rel="prefetch" href="/assets/SQLä¼˜åŒ–.html-W6wROULm.js" as="script"><link rel="prefetch" href="/assets/ä¸€æ¬¡SQLä¼˜åŒ–è®°å½•.html-CJavNhuk.js" as="script"><link rel="prefetch" href="/assets/å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶äº‹åŠ¡.html-C54xiVXQ.js" as="script"><link rel="prefetch" href="/assets/Oracle.html-DK7IklLK.js" as="script"><link rel="prefetch" href="/assets/Redis.html-DryekSkH.js" as="script"><link rel="prefetch" href="/assets/æ•°ä¹‹å’Œ.html-BddgFkey.js" as="script"><link rel="prefetch" href="/assets/æœ‰åºæ•°ç»„çš„å¹³æ–¹.html-fBTjlIEJ.js" as="script"><link rel="prefetch" href="/assets/ç§»é™¤å…ƒç´ .html-DSH1nSST.js" as="script"><link rel="prefetch" href="/assets/èºæ—‹çŸ©é˜µ.html-DFi3Zfnb.js" as="script"><link rel="prefetch" href="/assets/é“¾è¡¨ç¯‡.html-DVQW5NGj.js" as="script"><link rel="prefetch" href="/assets/é•¿åº¦æœ€å°çš„æ•°ç»„.html-DiKnL6k9.js" as="script"><link rel="prefetch" href="/assets/index.html-BrR1xXDr.js" as="script"><link rel="prefetch" href="/assets/å¿«é€Ÿæ’åºå’Œå †æ’åº.html-PS_aZYrh.js" as="script"><link rel="prefetch" href="/assets/äºŒåˆ†æ³•.html-C_tlOQHM.js" as="script"><link rel="prefetch" href="/assets/å“ˆå¸Œç¯‡.html-B9nGwgAc.js" as="script"><link rel="prefetch" href="/assets/é“¾è¡¨.html-DTMFwKqJ.js" as="script"><link rel="prefetch" href="/assets/Docker.html-DoYKms77.js" as="script"><link rel="prefetch" href="/assets/æ•°æ®ç»“æ„å›¾ç¤º.html-C6FVQeLm.js" as="script"><link rel="prefetch" href="/assets/å®ä¾‹åŒ–Node.html-DS1rsLUi.js" as="script"><link rel="prefetch" href="/assets/å¯¹è±¡é—´çš„å…³ç³».html-Cwwxg3RQ.js" as="script"><link rel="prefetch" href="/assets/ThreadLocal.html-BrxnRj5d.js" as="script"><link rel="prefetch" href="/assets/å…³é”®å­—.html-C3U8-7E8.js" as="script"><link rel="prefetch" href="/assets/404.html-C_8f2D8H.js" as="script"><link rel="prefetch" href="/assets/index.html-BOEBRVJQ.js" as="script"><link rel="prefetch" href="/assets/index.html-mFJIaOg4.js" as="script"><link rel="prefetch" href="/assets/index.html-Fg0MnRFL.js" as="script"><link rel="prefetch" href="/assets/index.html-Cw0sD6m9.js" as="script"><link rel="prefetch" href="/assets/index.html-Bkt3uBc6.js" as="script"><link rel="prefetch" href="/assets/index.html--NQznRsb.js" as="script"><link rel="prefetch" href="/assets/index.html-DVg8xfqx.js" as="script"><link rel="prefetch" href="/assets/index.html-6b2vCT4p.js" as="script"><link rel="prefetch" href="/assets/index.html-COk8Apj3.js" as="script"><link rel="prefetch" href="/assets/index.html-BSbozW4p.js" as="script"><link rel="prefetch" href="/assets/index.html-DRy6Ps1i.js" as="script"><link rel="prefetch" href="/assets/index.html-CVN5gF1j.js" as="script"><link rel="prefetch" href="/assets/index.html-BMhbQjEG.js" as="script"><link rel="prefetch" href="/assets/index.html-Dse49xp8.js" as="script"><link rel="prefetch" href="/assets/index.html-BSq5CZtd.js" as="script"><link rel="prefetch" href="/assets/index.html-CeLpO-e2.js" as="script"><link rel="prefetch" href="/assets/index.html-CYo1d9de.js" as="script"><link rel="prefetch" href="/assets/index.html-CCWcdhco.js" as="script"><link rel="prefetch" href="/assets/index.html-Dw46uNv6.js" as="script"><link rel="prefetch" href="/assets/index.html-Coh9yIub.js" as="script"><link rel="prefetch" href="/assets/index.html-BRPBLrtb.js" as="script"><link rel="prefetch" href="/assets/index.html-Cv91Kmvt.js" as="script"><link rel="prefetch" href="/assets/index.html-DmpYZN7u.js" as="script"><link rel="prefetch" href="/assets/index.html-sAEZkqor.js" as="script"><link rel="prefetch" href="/assets/index.html-IV0_U04s.js" as="script"><link rel="prefetch" href="/assets/index.html-s1ivZVnK.js" as="script"><link rel="prefetch" href="/assets/index.html-CioyGLFe.js" as="script"><link rel="prefetch" href="/assets/index.html-VBVEH0EP.js" as="script"><link rel="prefetch" href="/assets/index.html-BE6dMPUB.js" as="script"><link rel="prefetch" href="/assets/index.html-UL9aduEC.js" as="script"><link rel="prefetch" href="/assets/index.html-MhJe_I1q.js" as="script"><link rel="prefetch" href="/assets/index.html-D_AvuYkd.js" as="script"><link rel="prefetch" href="/assets/index.html-DmMjAYZe.js" as="script"><link rel="prefetch" href="/assets/index.html-D5BVB5A5.js" as="script"><link rel="prefetch" href="/assets/index.html-tBmcYL7O.js" as="script"><link rel="prefetch" href="/assets/index.html-q4hKAGMo.js" as="script"><link rel="prefetch" href="/assets/index.html-P7VXxmT7.js" as="script"><link rel="prefetch" href="/assets/index.html-CSjPlW8c.js" as="script"><link rel="prefetch" href="/assets/index.html-VH58z8HI.js" as="script"><link rel="prefetch" href="/assets/index.html-B-PgraHN.js" as="script"><link rel="prefetch" href="/assets/index.html-COHY863f.js" as="script"><link rel="prefetch" href="/assets/index.html-DeQw3SNL.js" as="script"><link rel="prefetch" href="/assets/index.html-08TgpJaq.js" as="script"><link rel="prefetch" href="/assets/index.html-4Tp5VsJG.js" as="script"><link rel="prefetch" href="/assets/index.html-D0alaTLc.js" as="script"><link rel="prefetch" href="/assets/index.html-CKwYeKXA.js" as="script"><link rel="prefetch" href="/assets/index.html-tp0FFeDT.js" as="script"><link rel="prefetch" href="/assets/index.html-JkMmB1-E.js" as="script"><link rel="prefetch" href="/assets/index.html-BiaA_ckV.js" as="script"><link rel="prefetch" href="/assets/index.html-CSROvVBw.js" as="script"><link rel="prefetch" href="/assets/index.html-D1iUNeYF.js" as="script"><link rel="prefetch" href="/assets/index.html-BBqufl4p.js" as="script"><link rel="prefetch" href="/assets/index.html-Df2KpiBn.js" as="script"><link rel="prefetch" href="/assets/index.html-Duz_umto.js" as="script"><link rel="prefetch" href="/assets/index.html-ByC04o_E.js" as="script"><link rel="prefetch" href="/assets/index.html-oANKmeit.js" as="script"><link rel="prefetch" href="/assets/index.html-QOmQNLyZ.js" as="script"><link rel="prefetch" href="/assets/index.html-D3DtdQ9_.js" as="script"><link rel="prefetch" href="/assets/index.html-ClFF4lZf.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/assets/index-BNnYFWcz.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/ç§’é€Ÿï¼•ã‚»ãƒ³ãƒãƒ¡ãƒ¼ãƒˆãƒ«.svg" alt><!----><!----></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="é›¨å±±"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-user-graduate" style=""></span><!--]-->é›¨å±±<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/portfolio.html" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/demo/" aria-label="æ–‡æ¡£å’Œç¬”è®°"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><!--]-->æ–‡æ¡£å’Œç¬”è®°<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E5%8F%8B%E9%93%BE.html" aria-label="æœ‹å‹ä»¬"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-user-graduate" style=""></span><!--]-->æœ‹å‹ä»¬<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/Todreamr/Dr.Magic" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:none;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:block;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><span class="vp-sidebar-title">åç«¯ç†è®º</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-check-square" style=""></span><span class="vp-sidebar-title">ç›˜å¤</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">ä¸­é—´ä»¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">æ•°æ®æº</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">ç»„ä»¶ä»‹ç»</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/chat%E6%A8%A1%E5%9D%97.html" aria-label="chatæ¨¡å—"><!---->chatæ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E5%BB%B6%E6%97%B6%E6%A8%A1%E5%9D%97.html" aria-label="Delayæ¨¡å—"><!---->Delayæ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E7%9B%98%E5%8F%A4-security.html" aria-label="Feignæ¨¡å—"><!---->Feignæ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/Https%E6%A8%A1%E5%9D%97.html" aria-label="Httpsæ¨¡å—"><!---->Httpsæ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/Mybatis-Plus.html" aria-label="MybatisPlusæ¨¡å—"><!---->MybatisPlusæ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/plug%E7%BB%84%E4%BB%B6.html" aria-label="plugç»„ä»¶"><!---->plugç»„ä»¶<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/SQL%E8%B7%9F%E8%B8%AA%E6%A8%A1%E5%9D%97.html" aria-label="SQLè·Ÿè¸ªæ¨¡å—"><!---->SQLè·Ÿè¸ªæ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/Swagger.html" aria-label="Swaggeræ¨¡å—"><!---->Swaggeræ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/xxl-job%E6%A8%A1%E5%9D%97.html" aria-label="xxl-jobæ¨¡å—"><!---->xxl-jobæ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E4%BB%93%E7%9B%92%E6%A8%A1%E5%9D%97.html" aria-label="ä»“ç›’æ¨¡å—"><!---->ä»“ç›’æ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E5%B7%A5%E5%85%B7%E7%B1%BB.html" aria-label="å·¥å…·ç±»"><!---->å·¥å…·ç±»<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E5%BC%82%E5%B8%B8%E6%A8%A1%E5%9D%97.html" aria-label="å¼‚å¸¸æ¨¡å—"><!---->å¼‚å¸¸æ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E6%8E%A7%E5%88%B6%E5%99%A8%E6%8E%92%E9%99%A4%E6%A8%A1%E5%9D%97.html" aria-label="æ§åˆ¶å™¨æ’é™¤æ¨¡å—"><!---->æ§åˆ¶å™¨æ’é™¤æ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E7%BC%93%E5%AD%98%E6%A8%A1%E5%9D%97.html" aria-label="æœ¬åœ°ç¼“å­˜æ¨¡å—(å·¥å…·)"><!---->æœ¬åœ°ç¼“å­˜æ¨¡å—(å·¥å…·)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E6%A1%86%E6%9E%B6%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97.html" aria-label="æ¡†æ¶æ—¥å¿—æ¨¡å—"><!---->æ¡†æ¶æ—¥å¿—æ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E7%9B%98%E5%8F%A4security%E6%A8%A1%E5%9D%97(%E5%90%AB%E6%8E%88%E6%9D%83).html" aria-label="ç›˜å¤securityæ¨¡å—(å«æˆæƒ)"><!---->ç›˜å¤securityæ¨¡å—(å«æˆæƒ)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/list%E5%B7%A5%E4%BD%9C%E6%B5%81%E9%9B%86%E6%88%90.html" aria-label="ç½‘å…³-é™æµ"><!---->ç½‘å…³-é™æµ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E8%84%B1%E6%95%8F%E5%92%8C%E6%8C%81%E4%B9%85%E5%B1%82%E5%8A%A0%E8%A7%A3%E5%AF%86.html" aria-label="è„±æ•&amp;æŒä¹…å±‚åŠ è§£å¯†"><!---->è„±æ•&amp;æŒä¹…å±‚åŠ è§£å¯†<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E7%9B%98%E5%8F%A4.html" aria-label="è‡ªç ”çš„åˆ†å¸ƒå¼æ¡†æ¶-ç›˜å¤"><!---->è‡ªç ”çš„åˆ†å¸ƒå¼æ¡†æ¶-ç›˜å¤<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E8%AE%A4%E8%AF%81%E6%A8%A1%E5%9D%97.html" aria-label="è®¤è¯æ¨¡å—"><!---->è®¤è¯æ¨¡å—<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E8%A7%A3%E5%AF%86%E6%A8%A1%E5%9D%97.html" aria-label="é…ç½®æ–‡ä»¶åŠ è§£å¯†æ¨¡å—"><!---->é…ç½®æ–‡ä»¶åŠ è§£å¯†æ¨¡å—<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">ç½‘å…³</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">é¹°çœ¼æ¡†æ¶</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">æ€è€ƒ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-check-square" style=""></span><span class="vp-sidebar-title">å¸®åŠ©</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->chatæ¨¡å—</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/ToDreamr" target="_blank" rel="noopener noreferrer">Cotton Eye Joe</a></span><span property="author" content="Cotton Eye Joe"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-11-18T07:25:41.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 15 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT15M"></span><!----><!----></div><hr></div><!----><!----><div class="theme-hope-content"><h1 id="chatæ¨¡å—" tabindex="-1"><a class="header-anchor" href="#chatæ¨¡å—"><span>chatæ¨¡å—</span></a></h1><blockquote><h4 id="å¦‚ä½•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨"><span>å¦‚ä½•ä½¿ç”¨</span></a></h4></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>åç«¯</span></span>
<span class="line"><span>ä¸šåŠ¡é¡¹ç›®ä¾èµ–å¦‚ä¸‹çš„pangu-frame-chat-apiæ¨¡å—</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>xml</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;com.kingtsoft.pangu&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;pangu-frame-chat-api&lt;/artifactId&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>ä¸šåŠ¡çš„å¯åŠ¨å™¨ä¾èµ–å¦‚ä¸‹çš„pangu-frame-chatæ¨¡å—</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>xml</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;com.kingtsoft.pangu&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;pangu-frame-chat&lt;/artifactId&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>é…ç½®chat çš„å®¢æˆ·ç«¯å®ç°ï¼Œç”¨äºè·å–ä¸­å¿ƒç«¯å‘é€çš„æ¶ˆæ¯ä¿¡æ¯&amp;ä¿¡æ¯å‘é€æ¥å£</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>package com.kingtsoft.pangu.frame.simple.test.listener;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import com.kingtsoft.pangu.frame.chat.api.PgChatClientApi;</span></span>
<span class="line"><span>import com.kingtsoft.pangu.frame.chat.api.PgChatTemplate;</span></span>
<span class="line"><span>import com.kingtsoft.pangu.frame.chat.common.PgChatEntity;</span></span>
<span class="line"><span>import lombok.extern.slf4j.Slf4j;</span></span>
<span class="line"><span>import org.springframework.stereotype.Component;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import java.util.HashMap;</span></span>
<span class="line"><span>import java.util.List;</span></span>
<span class="line"><span>import java.util.Map;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Title: &lt;br&gt;</span></span>
<span class="line"><span> * Description: &lt;br&gt;</span></span>
<span class="line"><span> * Company: KingTang &lt;br&gt;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * @author é‡‘ç‚€</span></span>
<span class="line"><span> * @version 1.0</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@Component</span></span>
<span class="line"><span>public class  PgChatClientImplimplementsPgChatClientApi {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private final   PgChatTemplate pgChatTemplate;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicPgChatClientImpl(PgChatTemplate pgChatTemplate) {</span></span>
<span class="line"><span>this.pgChatTemplate = pgChatTemplate;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * ä¸šåŠ¡ç«¯æ¶ˆæ¯ä¿¡æ¯å¤„ç†</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramchatList æ¶ˆæ¯</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   doChatProcess(List&lt;PgChatEntity&gt; chatList) {</span></span>
<span class="line"><span>for (PgChatEntity pgChatEntity : chatList) {</span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>                System.out.println(pgChatEntity.getContext());</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                Map&lt;String, Object&gt; m =new HashMap&lt;&gt;(4);</span></span>
<span class="line"><span>                m.put(&quot;empId&quot;, 1);</span></span>
<span class="line"><span>                pgChatTemplate.sendChat(&quot;pangu&quot;, &quot;ç¾¤å‘äº†&quot;, 1, m);</span></span>
<span class="line"><span>            } catch (Exception e) {</span></span>
<span class="line"><span>                log.error(&quot;æ—¥å¿—ä¸šåŠ¡ç«¯æ•°æ®å¤„ç†å¤±è´¥ï¼&quot;, e);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>PgChatTemplateç±»</span></span>
<span class="line"><span>    topicCodeä¸ºæ¶ˆæ¯ä¸»é¢˜ä»£ç ï¼Œä¸»è¦è®©ä¸­å¿ƒç«¯è¯†åˆ«æ˜¯å“ªä¸ªæ¨¡å—è¿‡æ¥çš„ï¼Œæ¯”å¦‚ç»æµå¯ä»¥æ˜¯emisï¼Œ</span></span>
<span class="line"><span>ä½†æ˜¯ä¹Ÿå¯ä»¥é™çº§ï¼Œæ¯”å¦‚ä¸€ä¸ªæŒ‚å·ä¸€ä¸ªä¸»é¢˜å«registerï¼ˆæ³¨æ„ï¼Œå¹¶ékafkaä¸»é¢˜ï¼Œè¿™é‡Œä¸­å¿ƒç«¯çš„</span></span>
<span class="line"><span>kafkaä¸»é¢˜æ˜¯å›ºå®šçš„ï¼‰ã€‚è‹¥è°ƒç”¨äº†ä¸å¸¦topicCodeçš„æ–¹æ³•ï¼Œä¼šä½¿ç”¨pangu.chat.topic-code</span></span>
<span class="line"><span>é…ç½®æ‰€é…ç½®çš„å†…å®¹ï¼Œå¯ä»¥åœ¨é¡¹ç›®é…ç½®æ–‡ä»¶å†…é…ç½®ã€‚ï¼ˆä¸€èˆ¬é…å¸¸é‡ç±»é‡Œï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>package com.kingtsoft.pangu.frame.chat.api;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import java.util.List;</span></span>
<span class="line"><span>import java.util.Map;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Title: &lt;br&gt;</span></span>
<span class="line"><span> * Description: &lt;br&gt;</span></span>
<span class="line"><span> * Company: KingTang &lt;br&gt;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * @author é‡‘ç‚€</span></span>
<span class="line"><span> * @version 1.0</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>public interface  PgChatTemplate {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramcontext ä¿¡æ¯</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String context);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramcontext ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramtimeout æœ‰æ•ˆæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String context, long timeout);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramcontext  ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammetaInfo é™„åŠ ä¿¡æ¯</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String context, Map&lt;String, Object&gt; metaInfo);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramcontext  ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammetaInfo é™„åŠ ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramtimeout  æœ‰æ•ˆæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String context, Map&lt;String, Object&gt; metaInfo, long timeout);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammetaInfos é™„åŠ ä¿¡æ¯</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String context, List&lt;Map&lt;String, Object&gt;&gt; metaInfos);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammetaInfos é™„åŠ ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramtimeout   æœ‰æ•ˆæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String context, List&lt;Map&lt;String, Object&gt;&gt; metaInfos, long timeout);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramtopicCode ä¸»é¢˜ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String topicCode, String context);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramtopicCode ä¸»é¢˜ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramtimeout   æœ‰æ•ˆæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String topicCode, String context, long timeout);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramtopicCode ä¸»é¢˜ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammetaInfo  é™„åŠ ä¿¡æ¯</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String topicCode, String context, Map&lt;String, Object&gt; metaInfo);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramtopicCode ä¸»é¢˜ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammetaInfo  é™„åŠ ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramtimeout   æœ‰æ•ˆæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String topicCode, String context, Map&lt;String, Object&gt; metaInfo, long timeout);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramtopicCode ä¸»é¢˜ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammetaInfos é™„åŠ ä¿¡æ¯</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String topicCode, String context, List&lt;Map&lt;String, Object&gt;&gt; metaInfos);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramtopicCode ä¸»é¢˜ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammetaInfos é™„åŠ ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramtimeout   æœ‰æ•ˆæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String topicCode, String context, List&lt;Map&lt;String, Object&gt;&gt; metaInfos, long timeout);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramtopicCode ä¸»é¢˜ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammsgType   ä¿¡æ¯ç±»å‹ 1-è½¬å‘æŒ‡å®šå®¢æˆ·ç«¯ 2-åŒç»„è½¬å‘</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String topicCode, String context, Integer msgType);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramtopicCode ä¸»é¢˜ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammsgType   ä¿¡æ¯ç±»å‹ 1-è½¬å‘æŒ‡å®šå®¢æˆ·ç«¯ 2-åŒç»„è½¬å‘</span></span>
<span class="line"><span>     * @paramtimeout   æœ‰æ•ˆæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String topicCode, String context, Integer msgType, long timeout);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramtopicCode ä¸»é¢˜ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammsgType   ä¿¡æ¯ç±»å‹ 1-è½¬å‘æŒ‡å®šå®¢æˆ·ç«¯ 2-åŒç»„è½¬å‘</span></span>
<span class="line"><span>     * @parammetaInfo  é™„åŠ ä¿¡æ¯</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String topicCode, String context, Integer msgType, Map&lt;String, Object&gt; metaInfo);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramtopicCode ä¸»é¢˜ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammsgType   ä¿¡æ¯ç±»å‹ 1-è½¬å‘æŒ‡å®šå®¢æˆ·ç«¯ 2-åŒç»„è½¬å‘</span></span>
<span class="line"><span>     * @parammetaInfo  é™„åŠ ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramtimeout   æœ‰æ•ˆæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String topicCode, String context, Integer msgType, Map&lt;String, Object&gt; metaInfo, long timeout);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramtopicCode ä¸»é¢˜ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammsgType   ä¿¡æ¯ç±»å‹ 1-è½¬å‘æŒ‡å®šå®¢æˆ·ç«¯ 2-åŒç»„è½¬å‘</span></span>
<span class="line"><span>     * @parammetaInfos é™„åŠ ä¿¡æ¯</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String topicCode, String context, Integer msgType, List&lt;Map&lt;String, Object&gt;&gt; metaInfos);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramtopicCode ä¸»é¢˜ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramcontext   ä¿¡æ¯</span></span>
<span class="line"><span>     * @parammsgType   ä¿¡æ¯ç±»å‹ 1-è½¬å‘æŒ‡å®šå®¢æˆ·ç«¯ 2-åŒç»„è½¬å‘</span></span>
<span class="line"><span>     * @parammetaInfos é™„åŠ ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramtimeout   æœ‰æ•ˆæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>voidsendChat(String topicCode, String context, Integer msgType, List&lt;Map&lt;String, Object&gt;&gt; metaInfos, long timeout);</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>é…ç½®æ–‡ä»¶</span></span>
<span class="line"><span>    é…ç½®kafka (chat-clientsä¸­é…ç½®çš„ä¸ºå®¢æˆ·ç«¯ç›‘å¬ä¼šå¯åŠ¨è‡ªåŠ¨ç›‘å¬æ¨¡å¼ï¼Œå¼€å¯åæ‰ä¼šå›è°ƒclientCodeæ‰€å¯¹åº”çš„</span></span>
<span class="line"><span>beanåç§°çš„PgChatClientApiæ¥å£å®ç°ï¼Œkeyä¸ºç›‘å¬IDï¼Œtopicsä¸ºç›‘å¬çš„ä¸»é¢˜ä¿¡æ¯ï¼Œå¤šä¸ªä»¥é€—å·åˆ†éš”ã€‚groupä¸ºåˆ†ç»„ã€‚</span></span>
<span class="line"><span>pangu.kafka.topics çš„é…ç½®ç”¨äºä¸»é¢˜ä¿¡æ¯çš„åŠ¨æ€ç”Ÿæˆ)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>yaml</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>spring:</span></span>
<span class="line"><span>kafka:</span></span>
<span class="line"><span>bootstrap-servers: &#39;10.1.50.131:9092&#39;</span></span>
<span class="line"><span>pangu:</span></span>
<span class="line"><span>chat:</span></span>
<span class="line"><span>kafka:</span></span>
<span class="line"><span>topic-center: &#39;topic.frame.center&#39;</span></span>
<span class="line"><span>chat-clients:</span></span>
<span class="line"><span>pangu:</span></span>
<span class="line"><span>topics: &#39;topic.frame.client&#39;</span></span>
<span class="line"><span>group: &#39;mainGroup&#39;</span></span>
<span class="line"><span>clientCode: &#39;pgChatClientImpl&#39;</span></span>
<span class="line"><span>emis:</span></span>
<span class="line"><span>topics: &#39;topic.emis.client&#39;</span></span>
<span class="line"><span>group: &#39;mainGroup&#39;</span></span>
<span class="line"><span>clientCode: &#39;pgChatClientImpl&#39;</span></span>
<span class="line"><span>kafka:</span></span>
<span class="line"><span>servers: ${spring.kafka.bootstrap-servers}</span></span>
<span class="line"><span>retries: 1</span></span>
<span class="line"><span>batch-size: 16384</span></span>
<span class="line"><span>linger: 1</span></span>
<span class="line"><span>buffer-memory: 1024000</span></span>
<span class="line"><span>group-id: bootKafka</span></span>
<span class="line"><span>auto-commit: true</span></span>
<span class="line"><span>commit-interval: 100</span></span>
<span class="line"><span>session-timeout: 15000</span></span>
<span class="line"><span>topics:</span></span>
<span class="line"><span>pangu:</span></span>
<span class="line"><span>name: &#39;topic.frame.client&#39;</span></span>
<span class="line"><span>num-partitions: 2</span></span>
<span class="line"><span>replication-factor: 2</span></span>
<span class="line"><span>panguCenter:</span></span>
<span class="line"><span>name: &#39;topic.emis.client&#39;</span></span>
<span class="line"><span>num-partitions: 2</span></span>
<span class="line"><span>replication-factor: 2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>wsä¸­å¿ƒç«¯éƒ¨ç½²</span></span>
<span class="line"><span>    chatå¹³å°ç«¯æ¨¡å—ä¸ºpangu-frame-chat-serverï¼Œå¯ç›´æ¥éƒ¨ç½²äºä¸€ä¸ªboxä¹‹ä¸­,å…¶é…ç½®æ–‡ä»¶å¦‚ä¸‹</span></span>
<span class="line"><span>(pangu.kafka.topics çš„é…ç½®ç”¨äºä¸»é¢˜ä¿¡æ¯çš„åŠ¨æ€ç”Ÿæˆ, auto-listener ä¸‹çš„ä¸ºè‡ªåŠ¨ç›‘å¬é…ç½®ã€‚</span></span>
<span class="line"><span>è¿™é‡Œéœ€è¦æŠŠæ‰€æœ‰å®¢æˆ·ç«¯ä¹Ÿé…ç½®è¿›å»ï¼Œç›®å‰å½“ä½œä¿¡æ¯åˆ—è¡¨ä½¿ç”¨ã€‚åç»­æœ‰å¯èƒ½è€ƒè™‘è‡ªåŠ¨å‘ç°)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>yaml</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>spring:</span></span>
<span class="line"><span>kafka:</span></span>
<span class="line"><span>bootstrap-servers: &#39;10.1.50.131:9092&#39;</span></span>
<span class="line"><span>pangu:</span></span>
<span class="line"><span>kafka:</span></span>
<span class="line"><span>servers: ${spring.kafka.bootstrap-servers}</span></span>
<span class="line"><span>retries: 1</span></span>
<span class="line"><span>batch-size: 16384</span></span>
<span class="line"><span>linger: 1</span></span>
<span class="line"><span>buffer-memory: 1024000</span></span>
<span class="line"><span>group-id: bootKafka</span></span>
<span class="line"><span>auto-commit: true</span></span>
<span class="line"><span>commit-interval: 100</span></span>
<span class="line"><span>session-timeout: 15000</span></span>
<span class="line"><span>topics:</span></span>
<span class="line"><span>panguCenter:</span></span>
<span class="line"><span>name: &#39;topic.frame.center&#39;</span></span>
<span class="line"><span>num-partitions: 2</span></span>
<span class="line"><span>replication-factor: 2</span></span>
<span class="line"><span>pangu:</span></span>
<span class="line"><span>name: &#39;topic.frame.client&#39;</span></span>
<span class="line"><span>num-partitions: 2</span></span>
<span class="line"><span>replication-factor: 2</span></span>
<span class="line"><span>panguEmis:</span></span>
<span class="line"><span>name: &#39;topic.emis.client&#39;</span></span>
<span class="line"><span>num-partitions: 2</span></span>
<span class="line"><span>replication-factor: 2</span></span>
<span class="line"><span>auto-listener:</span></span>
<span class="line"><span>enabled: true</span></span>
<span class="line"><span>auto-topics:</span></span>
<span class="line"><span>panguCenter:</span></span>
<span class="line"><span>topics: &#39;topic.frame.center&#39;</span></span>
<span class="line"><span>group: &#39;mainGroup&#39;</span></span>
<span class="line"><span>serviceCode: &#39;pgChatCenter&#39;</span></span>
<span class="line"><span>ws:</span></span>
<span class="line"><span>enabled: true</span></span>
<span class="line"><span>host: 127.0.0.1</span></span>
<span class="line"><span>port: 8185</span></span>
<span class="line"><span>path: pangu-websocket</span></span>
<span class="line"><span>#ä¸‹é¢è¿™éƒ¨åˆ†ä¸ºwsséœ€è¦å¼€å¯ï¼Œè¯ä¹¦å¿…é¡»ä¸ºæƒå¨è®¤è¯ï¼Œè‡ªç”Ÿæˆçš„ä¸è¡Œ</span></span>
<span class="line"><span>ssl:</span></span>
<span class="line"><span>enabled: false</span></span>
<span class="line"><span>password: kingtang</span></span>
<span class="line"><span>key-store: &#39;classpath:server.keystore&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>å‰ç«¯ä»£ç (æ‰§è¡Œå¿…è¦çš„å¿ƒè·³æœºåˆ¶åŠå„ä¸ªé’©å­å›è°ƒ)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>typescript</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>import { Injectable } from&#39;@angular/core&#39;;</span></span>
<span class="line"><span>import { WebsocketStorageService } from&#39;@services/websocket-storage.service&#39;;</span></span>
<span class="line"><span>import { SettingsService } from&#39;@services/settings.service&#39;;</span></span>
<span class="line"><span>import { PermissionService } from&#39;@services/permission.service&#39;;</span></span>
<span class="line"><span>import { Router } from&#39;@angular/router&#39;;</span></span>
<span class="line"><span>import { NzMessageService } from&#39;_ng-zorro-antd@13.3.2@ng-zorro-antd/message&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@Injectable()</span></span>
<span class="line"><span>exportclassInitService {</span></span>
<span class="line"><span>constructor(</span></span>
<span class="line"><span>privatewsStorage:WebsocketStorageService,</span></span>
<span class="line"><span>privatesetting:SettingsService,</span></span>
<span class="line"><span>privatepermissionService:PermissionService,</span></span>
<span class="line"><span>privaterouter:Router,</span></span>
<span class="line"><span>privatemessage:NzMessageService</span></span>
<span class="line"><span>  ) {</span></span>
<span class="line"><span>if (window.location.pathname?.indexOf(&#39;micro-app&#39;) &gt;=0) {</span></span>
<span class="line"><span>this.router.navigateByUrl(&#39;/layout&#39;, { skipLocationChange: false }).then((_) =&gt; {});</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>beatCount:number=0;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>heartTimer:any;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>initApp():Promise&lt;any&gt; {</span></span>
<span class="line"><span>returnnewPromise((resolve, _) =&gt; {</span></span>
<span class="line"><span>this.doSocketInIt();</span></span>
<span class="line"><span>resolve(null);</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>doSocketInIt() {</span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>if (typeof WebSocket ===&#39;undefined&#39;) {</span></span>
<span class="line"><span>        console.log(&#39;æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒsocket&#39;);</span></span>
<span class="line"><span>      } else {</span></span>
<span class="line"><span>// å®ä¾‹åŒ–socket</span></span>
<span class="line"><span>// @ts-ignore</span></span>
<span class="line"><span>        window.pgSocket =newWebSocket(window.uriMgt.websocketUrl);</span></span>
<span class="line"><span>// ç›‘å¬socketè¿æ¥</span></span>
<span class="line"><span>// @ts-ignore</span></span>
<span class="line"><span>        window.pgSocket.onopen =this.onSocketOpen;</span></span>
<span class="line"><span>// ç›‘å¬socketé”™è¯¯ä¿¡æ¯</span></span>
<span class="line"><span>// @ts-ignore</span></span>
<span class="line"><span>        window.pgSocket.onerror =this.onSocketError;</span></span>
<span class="line"><span>// ç›‘å¬socketæ¶ˆæ¯</span></span>
<span class="line"><span>// @ts-ignore</span></span>
<span class="line"><span>        window.pgSocket.onmessage= (ret:MessageEvent) =&gt; {</span></span>
<span class="line"><span>if (ret.data) {</span></span>
<span class="line"><span>constdata:any=JSON.parse(ret.data);</span></span>
<span class="line"><span>            console.log(data.msgStr);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>switch (data.msgType) {</span></span>
<span class="line"><span>case1:</span></span>
<span class="line"><span>// @ts-ignore</span></span>
<span class="line"><span>                window.pgSocketKey = data.msgStr;</span></span>
<span class="line"><span>this.sendHeart();</span></span>
<span class="line"><span>this.beatCount =0;</span></span>
<span class="line"><span>break;</span></span>
<span class="line"><span>case2:</span></span>
<span class="line"><span>// å¤„ç†ä¸šåŠ¡</span></span>
<span class="line"><span>break;</span></span>
<span class="line"><span>case3:</span></span>
<span class="line"><span>// è­¦å‘Šä¿¡æ¯å›è°ƒ</span></span>
<span class="line"><span>this.message.warning(data.msgStr);</span></span>
<span class="line"><span>break;</span></span>
<span class="line"><span>case4:</span></span>
<span class="line"><span>if (this.beatCount &gt;=1) {</span></span>
<span class="line"><span>this.beatCount--;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>break;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>this.wsStorage.socketCallBack.next(JSON.parse(ret.data));</span></span>
<span class="line"><span>          }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// // @ts-ignore</span></span>
<span class="line"><span>// window.pgSocket.send(</span></span>
<span class="line"><span>//   JSON.stringify({</span></span>
<span class="line"><span>//     // @ts-ignore</span></span>
<span class="line"><span>//     key: window.pgSocketKey,</span></span>
<span class="line"><span>//     msgType: 3,</span></span>
<span class="line"><span>//     msgStr: &#39;ä¸šåŠ¡æµ‹è¯•ï¼&#39;,</span></span>
<span class="line"><span>//   })</span></span>
<span class="line"><span>// );</span></span>
<span class="line"><span>        };</span></span>
<span class="line"><span>// @ts-ignore</span></span>
<span class="line"><span>        window.pgSocket.onclose= (ret:CloseEvent) =&gt; {</span></span>
<span class="line"><span>          console.log(ret);</span></span>
<span class="line"><span>if (this.heartTimer) {</span></span>
<span class="line"><span>clearInterval(this.heartTimer);</span></span>
<span class="line"><span>          }</span></span>
<span class="line"><span>this.beatCount =0;</span></span>
<span class="line"><span>        };</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    } catch (e:any) {</span></span>
<span class="line"><span>      console.error(&#39;websocket init fail&#39;);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>sendHeart() {</span></span>
<span class="line"><span>this.heartTimer =setInterval(() =&gt; {</span></span>
<span class="line"><span>// ä¸­é—´å¯èƒ½å­˜åœ¨å»¶è¿Ÿè¿‡é•¿å¯¼è‡´è®¡æ•°å™¨è¿‡å¤§ï¼Œè€Œæ²¡å‡å°çš„å¯èƒ½ï¼Œä½†æ˜¯å¿½ç•¥</span></span>
<span class="line"><span>if (this.beatCount &gt;=4) {</span></span>
<span class="line"><span>        console.log(&#39;æ‰§è¡Œé‡è¿&#39;);</span></span>
<span class="line"><span>this.doSocketInIt();</span></span>
<span class="line"><span>      } else {</span></span>
<span class="line"><span>        console.log(&#39;ping&#39;+this.beatCount);</span></span>
<span class="line"><span>// @ts-ignore</span></span>
<span class="line"><span>        window.pgSocket.send(</span></span>
<span class="line"><span>JSON.stringify({</span></span>
<span class="line"><span>            module: &#39;pangu&#39;,</span></span>
<span class="line"><span>            msgType: 4,</span></span>
<span class="line"><span>            msgStr: &#39;ping&#39;,</span></span>
<span class="line"><span>          })</span></span>
<span class="line"><span>        );</span></span>
<span class="line"><span>this.beatCount++;</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }, 5000);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>onSocketOpen(ret:any) {</span></span>
<span class="line"><span>// @ts-ignore</span></span>
<span class="line"><span>    window.pgSocket.send(</span></span>
<span class="line"><span>JSON.stringify({</span></span>
<span class="line"><span>        module: &#39;pangu&#39;,</span></span>
<span class="line"><span>        msgType: 1,</span></span>
<span class="line"><span>        msgStr: {</span></span>
<span class="line"><span>// empId: 1,</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>      })</span></span>
<span class="line"><span>    );</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>onSocketError(ret:any) {</span></span>
<span class="line"><span>    console.log(ret);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://pangu.kingtsoft.com/pangu-facade/assets/image1.b1f66964.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><blockquote><h4 id="æŠ€æœ¯åŸç†" tabindex="-1"><a class="header-anchor" href="#æŠ€æœ¯åŸç†"><span>æŠ€æœ¯åŸç†</span></a></h4></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>ç»„ä»¶äº¤äº’å›¾</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="http://pangu.kingtsoft.com/pangu-facade/assets/image2.f652bd0d.jpg" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>æ€»å…±ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ¨¡å—</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>pangu-frame-chat chatä¸šåŠ¡å¼•ç”¨æ¨¡å—ï¼ˆå¯ä»¥å½“å®¢æˆ·ç«¯ï¼‰ pangu-frame-chat-common chatæ ‡å‡†å¸¸é‡åŠæ•°æ®ç»“æ„ pangu-frame-chat-api chaté—¨é¢æ¥å£ pangu-frame-chat-center chatä¸­å¿ƒç«¯å¼•ç”¨æ¨¡å— pangu-frame-netty wsçš„å°è£… pangu-frame-chat-server é›†æˆwsä¸chatä¸­å¿ƒç«¯çš„æœåŠ¡ pangu-frame-simple-test ä¸šåŠ¡æ¨¡å—ä»£è¡¨ï¼Œè±¡å¾ä¸šåŠ¡</p></blockquote><p><strong>pangu-frame-chat</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    ä¸»è¦å°è£…äº†chatäº¤äº’çš„å…·ä½“å®ç°ï¼Œä¾‹å¦‚ä½¿ç”¨äº†kafkaä½œä¸ºåª’ä»‹</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>pangu-frame-chat-common</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    ä¸»è¦å°è£…äº†å¯¹chatæ¨¡å—çš„å„ç±»å¸¸é‡åŠæ•°æ®ç»“æ„PgChatEntityä¸PgChatCenterEntity</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>pangu-frame-chat-api</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    ä¸»è¦å°è£…äº†ä¸šåŠ¡ç«¯å„ç±»æ“ä½œæ‰€éœ€é—¨é¢api</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>pangu-frame-chat-center</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    ä¸ºæœåŠ¡ä¸­å¿ƒç«¯å®ç°ï¼Œåœ¨PgChatCenterTemplateä¸­æœ‰ä¸ªtopicCodeå‚æ•°ï¼Œæ­¤å‚æ•°ä¸é…ç½®</span></span>
<span class="line"><span>æ–‡ä»¶kafkaéƒ¨åˆ†çš„topicsä¸­çš„keyä¿æŒä¸€è‡´ã€‚é‡Œé¢æä¾›äº†é€šç”¨æ‰§è¡Œç¨‹åºçš„api pgChatCenterApiï¼Œ</span></span>
<span class="line"><span>åªè¦å¹³å°ç«¯å®ç°è¿™ä¸ªapiå°±å¯ä»¥å°†æ¶ˆæ¯ä¸­çš„æ•°æ®è‡ªåŠ¨ä¼ é€åˆ°æŒ‡å®šçš„apiæ–¹æ³•ã€‚å¦‚ä¸‹</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>package com.kingtsoft.pangu.frame.chat.server;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Title: &lt;br&gt;</span></span>
<span class="line"><span> * Description: &lt;br&gt;</span></span>
<span class="line"><span> * Company: KingTang &lt;br&gt;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * @author é‡‘ç‚€</span></span>
<span class="line"><span> * @version 1.0</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>@Component</span></span>
<span class="line"><span>public class  PgChatCenterHandlerimplementsPgChatCenterApi {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   doProcess(PgChatCenterEntity pgChatCenterEntity) {</span></span>
<span class="line"><span>if (Objects.equals(pgChatCenterEntity.getMsgType(), PgChatConst.ChatCenterMsgType.TYPE_GROUP)) {</span></span>
<span class="line"><span>            WebSocketTemplate.sendWsMsgGroup(pgChatCenterEntity.getTopicCode(), pgChatCenterEntity.getContext());</span></span>
<span class="line"><span>return;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        List&lt;ChannelEntity&gt; entityList =</span></span>
<span class="line"><span>                ChatChannelHandler.getChannelByMeta(</span></span>
<span class="line"><span>                        (allList, mapList) -&gt; {</span></span>
<span class="line"><span>if (mapList ==null|| mapList.size() ==0) {</span></span>
<span class="line"><span>returnnew ArrayList&lt;&gt;(allList);</span></span>
<span class="line"><span>                            }</span></span>
<span class="line"><span>                            List&lt;ChannelEntity&gt; finList =new ArrayList&lt;&gt;();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>for (Map&lt;String, Object&gt; map : mapList) {</span></span>
<span class="line"><span>for (ChannelEntity channelEntity : allList) {</span></span>
<span class="line"><span>                                    Map&lt;String, Object&gt; channelMeta = channelEntity.getMetaInfo();</span></span>
<span class="line"><span>if (channelMeta ==null) {</span></span>
<span class="line"><span>continue;</span></span>
<span class="line"><span>                                    }</span></span>
<span class="line"><span>if (!Objects.equals(channelEntity.getModule(), pgChatCenterEntity.getTopicCode())) {</span></span>
<span class="line"><span>continue;</span></span>
<span class="line"><span>                                    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>for (String key : map.keySet()) {</span></span>
<span class="line"><span>if (Objects.equals(channelMeta.get(key), map.get(key))) {</span></span>
<span class="line"><span>                                            finList.add(channelEntity);</span></span>
<span class="line"><span>break;</span></span>
<span class="line"><span>                                        }</span></span>
<span class="line"><span>                                    }</span></span>
<span class="line"><span>                                }</span></span>
<span class="line"><span>                            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>return finList;</span></span>
<span class="line"><span>                        }, pgChatCenterEntity.getMetaInfos());</span></span>
<span class="line"><span></span></span>
<span class="line"><span>for (ChannelEntity channelEntity : entityList) {</span></span>
<span class="line"><span>            WebSocketTemplate.sendWsMsg(channelEntity.getChannelId().aslong Text(), pgChatCenterEntity.getContext());</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>pangu-frame-netty</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    æ­¤æ¨¡å—æ˜¯é’ˆå¯¹wså…·ä½“å®ç°çš„å°è£…ï¼Œæ”¯æŒWSSçš„çš„æ¥å…¥ï¼Œä½†æ˜¯ç»è¿‡æµ‹è¯•ï¼Œwssæ¨¡å¼ä¸‹æ— æ³•ä½¿ç”¨ç§äººç”Ÿ</span></span>
<span class="line"><span>æˆçš„è¯ä¹¦ã€‚å®šä¹‰äº†æ•°æ®ç»“æ„ChatPojoä¸ChatBackPojoï¼Œå‰è€…ä¸ºwså®¢æˆ·ç«¯å‘é€ä¿¡æ¯åˆ°æœåŠ¡ç«¯çš„æ•°æ®ç»“</span></span>
<span class="line"><span>æ„ï¼Œåè€…ä¸ºæœåŠ¡ç«¯å‘é€åˆ°å®¢æˆ·ç«¯çš„æ•°æ®ç»“æ„ã€‚</span></span>
<span class="line"><span>    ChatPojo ä¸­ç€é‡æ³¨æ„çš„ä¸ºmsgTypeï¼Œ1-åˆå§‹å»ºç«‹ï¼ˆç”¨ä»¥äº’ç›¸ä¿å­˜ç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥æ˜¯ä¸šåŠ¡å…³é”®ä¿¡æ¯ï¼Œ</span></span>
<span class="line"><span>ä¾‹å¦‚empId,è¿™æ ·åç»­æƒ³é€šè¿‡empIdè¿›è¡Œå‘é€çš„è¯å°±èƒ½ä»¥è¿™äº›è‡ªå®šä¹‰ä¿¡æ¯ä¸ºä¾æ®è¿›è¡Œå¹¿æ’­ï¼‰ 2-åŒç»„ç›´æ¥è½¬</span></span>
<span class="line"><span>å‘ï¼ˆä¸ç»è¿‡ä¸šåŠ¡åç«¯ï¼Œç›´æ¥å°†ä¿¡æ¯è½¬å‘ç»™åŒæ¨¡å—ä¸‹çš„å®¢æˆ·ç«¯ï¼‰ 3-åç«¯ä¸šåŠ¡é€»è¾‘ï¼ˆé€šè¿‡æ¶ˆæ¯å»æ‰§è¡Œåç«¯é€»è¾‘ï¼‰</span></span>
<span class="line"><span>4-å¿ƒè·³æ£€æµ‹ã€‚</span></span>
<span class="line"><span>å››ç§ç±»å‹æ ¸å¿ƒä»£ç å¦‚ä¸‹</span></span>
<span class="line"><span>    å®¢æˆ·ç«¯åœ¨å»ºç«‹è¿æ¥åä¼šæ‰§è¡Œä¸€ä¸ªé¢å¤–çš„ç±»å‹ä¸º1çš„ä¿¡æ¯ï¼ˆéœ€è¦æ ‡è®°è‡ªèº«çš„moduleï¼Œä¸topicä¸­çš„key</span></span>
<span class="line"><span>ä¿æŒä¸€è‡´ï¼‰ï¼Œç”¨æ¥å‘Šè¯‰æœåŠ¡ç«¯å¯¹ç®¡é“ä¿¡æ¯çš„ä¿å­˜åŠåˆå§‹åŒ–ï¼Œç„¶åå°†åˆå§‹åŒ–åçš„å…³é”®keyå‘é€ç»™å®¢æˆ·ç«¯è¿›è¡Œ</span></span>
<span class="line"><span>ä¿å­˜ï¼Œåç»­çš„ä¸šåŠ¡äº¤äº’éƒ½éœ€è¦é™„åŠ è¿™ä¸ªkeyã€‚</span></span>
<span class="line"><span>    æŸ¥çœ‹private void   doProcess(ChannelHandlerContext ctx, String msgStr)å¯ä»¥</span></span>
<span class="line"><span>å‘ç°ï¼Œåœ¨ç›´è¿å‘é€çš„æƒ…å†µä¹‹å¤–çš„æµç¨‹ä¹Ÿå°±æ˜¯msgType=2æˆ–3çš„æƒ…å†µéƒ½æ˜¯ç”±nettyProcessApiè¿›è¡Œæ‰˜ç®¡å¤„ç†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>package com.kingtsoft.pangu.frame.netty;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import com.alibaba.fastjson2.JSON;</span></span>
<span class="line"><span>import com.kingtsoft.pangu.base.exception.TipException;</span></span>
<span class="line"><span>import com.kingtsoft.pangu.frame.netty.constant.ChatConst;</span></span>
<span class="line"><span>import io.netty.channel.ChannelHandlerContext;</span></span>
<span class="line"><span>import io.netty.channel.SimpleChannelInboundHandler;</span></span>
<span class="line"><span>import io.netty.handler.codec.http.FullHttpRequest;</span></span>
<span class="line"><span>import io.netty.handler.codec.http.websocketx.*;</span></span>
<span class="line"><span>import lombok.extern.slf4j.Slf4j;</span></span>
<span class="line"><span>import org.springframework.util.StringUtils;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Title: &lt;br&gt;</span></span>
<span class="line"><span> * Description: &lt;br&gt;</span></span>
<span class="line"><span> * Company: wondersgroup.com &lt;br&gt;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * @author é‡‘ç‚€</span></span>
<span class="line"><span> * @version 1.0</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>@Slf4j</span></span>
<span class="line"><span>public class  ChatWebSocketHandlerextendsSimpleChannelInboundHandler&lt;WebSocketFrame&gt; {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private final   NettyProcessApi nettyProcessApi;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicChatWebSocketHandler(NettyProcessApi nettyProcessApi) {</span></span>
<span class="line"><span>this.nettyProcessApi = nettyProcessApi;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   channelActive(ChannelHandlerContext ctx) throws Exception {</span></span>
<span class="line"><span>        log.info(&quot;å®¢æˆ·ç«¯è¿æ¥ï¼š{}&quot;, ctx.channel().id());</span></span>
<span class="line"><span>super.channelActive(ctx);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   channelInactive(ChannelHandlerContext ctx) throws Exception {</span></span>
<span class="line"><span>        log.info(&quot;ä¸å®¢æˆ·ç«¯è¿æ¥æ–­å¼€ï¼Œé€šé“å…³é—­&quot;);</span></span>
<span class="line"><span>        ChatChannelHandler.removeChannel(ctx.channel().id());</span></span>
<span class="line"><span>super.channelInactive(ctx);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   channelReadComplete(ChannelHandlerContext ctx) {</span></span>
<span class="line"><span>        ctx.channel().flush();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>protectedvoidchannelRead0(ChannelHandlerContext ctx, WebSocketFrame frame) {</span></span>
<span class="line"><span>if (frame instanceof PingWebSocketFrame) {</span></span>
<span class="line"><span>pingWebSocketFrameHandler(ctx, (PingWebSocketFrame) frame);</span></span>
<span class="line"><span>        } elseif (frame instanceof TextWebSocketFrame) {</span></span>
<span class="line"><span>textWebSocketFrameHandler(ctx, (TextWebSocketFrame) frame);</span></span>
<span class="line"><span>        } elseif (frame instanceof CloseWebSocketFrame) {</span></span>
<span class="line"><span>closeWebSocketFrameHandler(ctx, (CloseWebSocketFrame) frame);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {</span></span>
<span class="line"><span>//é¦–æ¬¡è¿æ¥æ˜¯FullHttpRequestï¼Œå¤„ç†å‚æ•°</span></span>
<span class="line"><span>if (msg instanceof FullHttpRequest) {</span></span>
<span class="line"><span>            FullHttpRequest request = (FullHttpRequest) msg;</span></span>
<span class="line"><span>            String uri = request.uri();</span></span>
<span class="line"><span>            WebSocketTemplate.sendWsMsg(ctx.channel(), &quot;æ±¤å°å¸…æœåŠ¡ä¸­å¿ƒæŒç»­ä¸ºæ‚¨æœåŠ¡ï¼&quot;);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>super.channelRead(ctx, msg);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å®¢æˆ·ç«¯å‘é€æ–­å¼€è¯·æ±‚å¤„ç†</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>private void  closeWebSocketFrameHandler(ChannelHandlerContext ctx, CloseWebSocketFrame frame) {</span></span>
<span class="line"><span>        log.info(&quot;æ¥æ”¶åˆ°ä¸»åŠ¨æ–­å¼€è¯·æ±‚ï¼š{}&quot;, ctx.channel().id());</span></span>
<span class="line"><span>        ctx.close();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * åˆ›å»ºè¿æ¥ä¹‹åï¼Œå®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯éƒ½ä¼šåœ¨è¿™é‡Œå¤„ç†</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>private void  textWebSocketFrameHandler(ChannelHandlerContext ctx, TextWebSocketFrame frame) {</span></span>
<span class="line"><span>        String text = frame.text();</span></span>
<span class="line"><span>        ChatPoolUtil.POOL.execute(() -&gt;doProcess(ctx, text));</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å¤„ç†å®¢æˆ·ç«¯å¿ƒè·³åŒ…</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>private void  pingWebSocketFrameHandler(ChannelHandlerContext ctx, PingWebSocketFrame frame) {</span></span>
<span class="line"><span>        ctx.channel().writeAndFlush(newPongWebSocketFrame(frame.content().retain()));</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private void  doProcess(ChannelHandlerContext ctx, String msgStr) {</span></span>
<span class="line"><span>        ChatPojo chatPojo;</span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>            chatPojo = JSON.parseObject(msgStr, ChatPojo.class);</span></span>
<span class="line"><span>        } catch (Exception e) {</span></span>
<span class="line"><span>thrownewTipException(&quot;æœªçŸ¥çš„æ¶ˆæ¯ç»“æ„ä½“ï¼&quot;);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if (nettyProcessApi ==null) {</span></span>
<span class="line"><span>thrownewTipException(&quot;æ— å¯ç”¨æ‰§è¡Œå™¨ï¼&quot;);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>switch (chatPojo.getMsgType()) {</span></span>
<span class="line"><span>case1:</span></span>
<span class="line"><span>                ChannelEntity channelEntity =newChannelEntity();</span></span>
<span class="line"><span>                channelEntity.setChannelId(ctx.channel().id());</span></span>
<span class="line"><span>                channelEntity.setModule(chatPojo.getModule());</span></span>
<span class="line"><span>                String meta = chatPojo.getMsgStr();</span></span>
<span class="line"><span>if (StringUtils.hasText(meta)) {</span></span>
<span class="line"><span>                    channelEntity.setMetaInfo(JSON.parseObject(meta));</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                String key = ChatChannelHandler.addChannelId(channelEntity, ctx.channel());</span></span>
<span class="line"><span>                WebSocketTemplate.sendWsMsg(ctx.channel(), key, ChatConst.BackType.TYPE_CONNECT);</span></span>
<span class="line"><span>break;</span></span>
<span class="line"><span>case2:</span></span>
<span class="line"><span>                nettyProcessApi.doSameGroup(ctx, chatPojo);</span></span>
<span class="line"><span>break;</span></span>
<span class="line"><span>case3:</span></span>
<span class="line"><span>                nettyProcessApi.doProcess(ctx, chatPojo);</span></span>
<span class="line"><span>break;</span></span>
<span class="line"><span>case4:</span></span>
<span class="line"><span>                WebSocketTemplate.sendWsMsg(ctx.channel(), &quot;pong&quot;, ChatConst.BackType.TYPE_HEART_BEAT);</span></span>
<span class="line"><span>break;</span></span>
<span class="line"><span>default:</span></span>
<span class="line"><span>// å°†å®¢æˆ·ç«¯æ¶ˆæ¯å›é€ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span>                WebSocketTemplate.sendWsMsg(ctx.channel(), &quot;ä½ å‘é€çš„å†…å®¹æ˜¯ï¼š&quot;+ chatPojo.getMsgStr());</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>   ChatBackPojo ä¸­çš„msgTypeä¸º1-å»ºç«‹è¿æ¥å›è°ƒ 2-å›å¤ä¿¡æ¯ï¼ˆå¸¸è§„ä¿¡æ¯å›å¤ç”¨ä»¥ä¸šåŠ¡å¤„ç†ï¼‰ 3-è­¦å‘Šä¿¡æ¯|é”™è¯¯åé¦ˆ</span></span>
<span class="line"><span>ï¼ˆå› ä¸ºè¦ä¸å¸¸è§„ä¿¡æ¯åŒºåˆ†ï¼Œæœ‰æ—¶å€™æœåŠ¡ç«¯çš„wsä¿¡æ¯å¯èƒ½æ“ä½œä¼šå‡ºç°å¼‚å¸¸ï¼Œè¿™æ—¶å€™ä¼šç”¨3è¿™ä¸ªçŠ¶æ€å°†å¼‚å¸¸ä¿¡æ¯åé¦ˆï¼Œå®¢æˆ·ç«¯å¯ä»¥</span></span>
<span class="line"><span>è‡ªå·±è€ƒè™‘åç»­æ“ä½œï¼Œæ¯”å¦‚å¯ä»¥message.warnåˆ°é¡µé¢ï¼‰</span></span>
<span class="line"><span>    åŒæ ·æä¾›äº†ä¸€ä¸ªapi nettyProcessApiæä¾›å¹³å°æ•´ä¸ªçš„æ—¶å€™å¯¹å…·ä½“åç«¯ä¸šåŠ¡è¿›è¡Œå®ç°ï¼Œå¦‚ä¸‹ï¼Œå¯ä»¥å‘ç°ä¸¤ä¸ªæ¥å£æœ€åéƒ½æ˜¯</span></span>
<span class="line"><span>èµ°çš„æ¶ˆæ¯ï¼Œä¸”æ¶ˆæ¯çš„ä¸»é¢˜é»˜è®¤ä¸ºtopic.pangu.center-clusterï¼Œå¯ä»¥é€šè¿‡pangu.chat.kafka.topic-centerè¿›è¡Œ</span></span>
<span class="line"><span>è®¾ç½®ã€‚è¿™é‡Œçš„é€šè¿‡kafkaå®ç°çš„ï¼Œæ‰€æœ‰ç»§ç»­å¾€ä¸‹æ‰¾kafka</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>package com.kingtsoft.pangu.frame.chat.server;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import com.alibaba.fastjson2.JSON;</span></span>
<span class="line"><span>import com.kingtsoft.pangu.frame.chat.common.constant.PgChatConst;</span></span>
<span class="line"><span>import com.kingtsoft.pangu.frame.netty.*;</span></span>
<span class="line"><span>import io.netty.channel.ChannelHandlerContext;</span></span>
<span class="line"><span>import lombok.extern.slf4j.Slf4j;</span></span>
<span class="line"><span>import org.springframework.core.env.Environment;</span></span>
<span class="line"><span>import org.springframework.kafka.core.KafkaTemplate;</span></span>
<span class="line"><span>import org.springframework.kafka.support.KafkaHeaders;</span></span>
<span class="line"><span>import org.springframework.messaging.Message;</span></span>
<span class="line"><span>import org.springframework.messaging.MessageHeaders;</span></span>
<span class="line"><span>import org.springframework.messaging.support.GenericMessage;</span></span>
<span class="line"><span>import org.springframework.stereotype.Component;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import java.time.Clock;</span></span>
<span class="line"><span>import java.time.ZoneId;</span></span>
<span class="line"><span>import java.util.HashMap;</span></span>
<span class="line"><span>import java.util.Map;</span></span>
<span class="line"><span>import java.util.UUID;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Title: &lt;br&gt;</span></span>
<span class="line"><span> * Description: &lt;br&gt;</span></span>
<span class="line"><span> * Company: wondersgroup.com &lt;br&gt;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * @author é‡‘ç‚€</span></span>
<span class="line"><span> * @version 1.0</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@Component</span></span>
<span class="line"><span>public class  NettyProcessHandlerimplementsNettyProcessApi {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>privatestaticfinal Clock CLOCK = Clock.system(ZoneId.of(&quot;GMT+8&quot;));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private final   KafkaTemplate&lt;String, Object&gt; kafkaTemplate;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private final   String topicCenter;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicNettyProcessHandler(Environment environment,</span></span>
<span class="line"><span>                               KafkaTemplate&lt;String, Object&gt; kafkaTemplate) {</span></span>
<span class="line"><span>this.topicCenter = environment.getProperty(&quot;pangu.chat.kafka.topic-center&quot;, PgChatConst.PG_TOPIC_CHAT_CLUSTER);</span></span>
<span class="line"><span>this.kafkaTemplate = kafkaTemplate;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   doSameGroup(ChannelHandlerContext ctx, ChatPojo chatPojo) {</span></span>
<span class="line"><span>sendMsg(chatPojo, -1L);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * ä¸šåŠ¡å†…å®¹æ¥å£</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramctx      ç®¡é“ä¸Šä¸‹æ–‡ä¿¡æ¯</span></span>
<span class="line"><span>     * @paramchatPojo äº¤äº’ä¿¡æ¯</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   doProcess(ChannelHandlerContext ctx, ChatPojo chatPojo) {</span></span>
<span class="line"><span>sendMsg(chatPojo, -1L);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramchatPojo å°è£…ä¿¡æ¯</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>private void  sendMsg(ChatPojo chatPojo, long  timeout) {</span></span>
<span class="line"><span>if (timeout ==-1L) {</span></span>
<span class="line"><span>            timeout =null;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        Map&lt;String, Object&gt; map =new HashMap&lt;&gt;(8);</span></span>
<span class="line"><span>        map.put(KafkaHeaders.TOPIC, topicCenter);</span></span>
<span class="line"><span>        map.put(KafkaHeaders.KEY, createMsgKey());</span></span>
<span class="line"><span>        map.put(PgChatConst.ChatKafkaHeader.TIMEOUT, timeout);</span></span>
<span class="line"><span>        map.put(PgChatConst.ChatKafkaHeader.START_TIMESTAMP, CLOCK.millis());</span></span>
<span class="line"><span></span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>            Message&lt;String&gt; message =new GenericMessage&lt;&gt;(JSON.toJSONString(chatPojo), newMessageHeaders(map));</span></span>
<span class="line"><span>            kafkaTemplate.send(message);</span></span>
<span class="line"><span>        } catch (Exception e) {</span></span>
<span class="line"><span>            log.error(&quot;æ¶ˆæ¯å‘é€å¤±è´¥ï¼&quot;, e);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicstatic String createMsgKey() {</span></span>
<span class="line"><span>return UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;&quot;);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    åœ¨chat-ä¸­å¿ƒæ¨¡å—ä¸­ï¼ŒPgCenterClusterListenerImplç±»æ˜¯é€šè¿‡kafkaçš„</span></span>
<span class="line"><span>é…ç½®åŒ–è‡ªåŠ¨ç›‘å¬å®ç°çš„ï¼Œå¯ä»¥ç›‘å¬ä»nettyæ¨¡å—ä¸­ä¼ æ’­å‡ºæ¥çš„ä¸šåŠ¡å¤„ç†ä¿¡æ¯ï¼Œè¿™ä¹ˆåš</span></span>
<span class="line"><span>ä¸»è¦æ˜¯ç”¨äºè§£å†³åˆ†å¸ƒå¼æ¨¡å¼ä¸‹çš„å¤šå®ä¾‹ï¼Œå› ä¸ºå‰ç«¯åªä¼šè·Ÿä¸€å°netty-serverè¿›è¡Œé•¿</span></span>
<span class="line"><span>è¿æ¥ï¼Œè€Œåˆ†å¸ƒå¼æ¨¡å¼ä¸‹å‡ºäºé«˜å¯ç”¨åŠè´Ÿè½½çš„è€ƒè™‘ä¼šå­˜åœ¨å¤šä¸ªå®ä¾‹ï¼Œè€Œæ­¤æ—¶éœ€è¦é€šè¿‡æ¯å°</span></span>
<span class="line"><span>è¿›è¡Œå®ä¾‹å¹¿æ’­ã€‚æˆ‘ä»¬é€šè¿‡æ¶ˆæ¯å¹¿æ’­å®ç°äº†è¿™ä¸ªåŠŸèƒ½ã€‚</span></span>
<span class="line"><span>    è¿™é‡Œé»˜è®¤ä¹Ÿæœ‰ä¸€ä¸ªtimeoutçš„å¤„ç†ï¼Œä¸»è¦ç”¨äºå¤„ç†ä¸€äº›éœ€è¦æ—¶æ•ˆæ€§çš„ä¿¡æ¯ï¼Œå¯ä»¥</span></span>
<span class="line"><span>åœ¨å‘é€çš„æ—¶å€™é…ç½®å¥½å¤´ä¿¡æ¯ã€‚è¿™é‡Œä¼šåœ¨æ¥å—åˆ°çš„æ—¶å€™è‡ªåŠ¨ä¸¢å¼ƒ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>package com.kingtsoft.pangu.frame.chat.center.kafka;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Title: &lt;br&gt;</span></span>
<span class="line"><span> * Description: &lt;br&gt;</span></span>
<span class="line"><span> * Company: KingTang &lt;br&gt;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * @author é‡‘ç‚€</span></span>
<span class="line"><span> * @version 1.0</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@Component(PgChatConst.ChatKafkaServiceCode.CODE_CENTER_CLUSTER)</span></span>
<span class="line"><span>public class  PgCenterClusterListenerImplimplementsPgKafkaBatchMessageService {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>privatestaticfinal Clock CLOCK = Clock.system(ZoneId.of(&quot;GMT+8&quot;));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private final   PgChatCenterApi pgChatCenterApi;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicPgCenterClusterListenerImpl(PgChatCenterApi pgChatCenterApi) {</span></span>
<span class="line"><span>this.pgChatCenterApi = pgChatCenterApi;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * ä¸šåŠ¡ç«¯æ¶ˆæ¯ä¿¡æ¯å¤„ç†</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramdata æ¶ˆæ¯</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   doBatchMessageProcess(List&lt;ConsumerRecord&lt;String, String&gt;&gt; data) {</span></span>
<span class="line"><span>for (ConsumerRecord&lt;String, String&gt; record : data) {</span></span>
<span class="line"><span>            Optional&lt;String&gt; message = Optional.ofNullable(record.value());</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if (message.isEmpty()) {</span></span>
<span class="line"><span>                log.info(&quot;chatä¸­å¿ƒæ¥å—æ•°æ®ä¸ºç©ºï¼&quot;);</span></span>
<span class="line"><span>return;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if (record.headers() !=null) {</span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>                    Header header = record.headers().lastHeader(PgChatConst.ChatKafkaHeader.START_TIMESTAMP);</span></span>
<span class="line"><span>                    Header timeoutHeader = record.headers().lastHeader(PgChatConst.ChatKafkaHeader.TIMEOUT);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if (header !=null&amp;&amp; timeoutHeader !=null) {</span></span>
<span class="line"><span>long  startTimestamp = long .parselong (newString(header.value(), StandardCharsets.UTF_8));</span></span>
<span class="line"><span>long  timeout = long .parselong (newString(timeoutHeader.value(), StandardCharsets.UTF_8));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if (startTimestamp + timeout &lt; CLOCK.millis()) {</span></span>
<span class="line"><span>continue;</span></span>
<span class="line"><span>                        }</span></span>
<span class="line"><span>                    }</span></span>
<span class="line"><span>                } catch (Exception ignore) {}</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>                pgChatCenterApi.doCenterProcess(message.get());</span></span>
<span class="line"><span>            } catch (Exception e) {</span></span>
<span class="line"><span>                log.error(&quot;chatä¸­å¿ƒæ‰§è¡Œå¤±è´¥ï¼&quot;, e);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>  å°è£…äº†WebSocketTemplateå¯ä»¥ä¾¿æ·é€šè¿‡keys keyæˆ–è€…ç»„æˆ–è€…channelæœ¬èº«ç­‰å…³é”®å†…å®¹å¯¹æ¶ˆæ¯è¿›è¡Œå‘é€ã€‚</span></span>
<span class="line"><span>å°è£…äº†ç®¡é“ç¼“å­˜ç±»ChatChannelHandlerï¼Œä»£ç å¦‚ä¸‹ï¼Œä¸»è¦å¯¹ç®¡é“ç»„åŠchannelä¿¡æ¯è¿›è¡Œäº†ä¿å­˜ã€‚å…¶ä¸­ä¿å­˜å½¢</span></span>
<span class="line"><span>å¼ä»¥ChannelEntityä¸ºä¸»ï¼Œç®¡é“æœ¬èº«æ³¨å†Œåœ¨äº†ChannelGroupä¸­ï¼ŒåŒmoduleä¸­éƒ½ä½¿ç”¨åŒä¸€ä¸ªChannelGroup</span></span>
<span class="line"><span>ä¿å­˜ã€‚è¿™æ ·å°±æ›´åŠ è‡ªç”±çš„å‘æŒ¥è‡ªå¸¦çš„ChannelGroupä¼˜åŠ¿ï¼Œå¯ä»¥å¯¹åŒç»„è¿›è¡Œæ‰¹é‡å¤„ç†ã€‚å…¶ä¸­getChannelByMeta</span></span>
<span class="line"><span>å°±æ˜¯æä¾›è‡ªå®šä¹‰æ•°æ®è¿‡æ»¤çš„æ–¹æ³•ï¼Œè¿™æ ·ä¸šåŠ¡ä¸chatç»„ä»¶ä¹‹é—´å°±ä¸ä¼šäº§ç”Ÿè€¦åˆã€‚è€Œå…·ä½“è¿‡æ»¤æ–¹æ³•ä¹Ÿä½¿ç”¨äº†å‡½æ•°å¼ç¼–ç¨‹</span></span>
<span class="line"><span>è®©å¹³å°å»è‡ªå®ç°ï¼Œä¹Ÿè§£è€¦äº†å¹³å°é€»è¾‘ä¸chatç»„ä»¶é€»è¾‘ã€‚</span></span>
<span class="line"><span>ï¼ˆæ­¤æ¨¡å—è¿æ¥çš„wsï¼Œåœ¨2å°æ—¶æ²¡æœ‰åŠ¨é™çš„æƒ…å†µä¸‹ï¼Œä¼šç›‘æµ‹ä¸€ä¸‹ï¼Œå¦‚æœæ²¡å“åº”ï¼Œåˆ™ä¼šè‡ªåŠ¨æ–­å¼€ï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>package com.kingtsoft.pangu.frame.netty;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import io.netty.channel.Channel;</span></span>
<span class="line"><span>import io.netty.channel.ChannelId;</span></span>
<span class="line"><span>import io.netty.channel.group.ChannelGroup;</span></span>
<span class="line"><span>import io.netty.channel.group.ChannelMatchers;</span></span>
<span class="line"><span>import io.netty.channel.group.DefaultChannelGroup;</span></span>
<span class="line"><span>import io.netty.util.concurrent.GlobalEventExecutor;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import java.util.List;</span></span>
<span class="line"><span>import java.util.Map;</span></span>
<span class="line"><span>import java.util.concurrent.ConcurrentHashMap;</span></span>
<span class="line"><span>import java.util.concurrent.atomic.AtomicReference;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Title: &lt;br&gt;</span></span>
<span class="line"><span> * Description: &lt;br&gt;</span></span>
<span class="line"><span> * Company: KingTang.com &lt;br&gt;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * @author é‡‘ç‚€</span></span>
<span class="line"><span> * @version 1.0</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>public class  ChatChannelHandler {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicstatic Map&lt;String, ChannelGroup&gt; channelGroupMap =new ConcurrentHashMap&lt;&gt;(16);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicstatic Map&lt;String, ChannelEntity&gt; channelInfoMap =new ConcurrentHashMap&lt;&gt;(32);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicstatic String addChannelId(ChannelEntity channelEntity, Channel channel) {</span></span>
<span class="line"><span>        String key = channel.id().aslong Text();</span></span>
<span class="line"><span>// å¤„ç†é€šé“ç»„</span></span>
<span class="line"><span>if (channelGroupMap.get(channelEntity.getModule()) ==null) {</span></span>
<span class="line"><span>            ChannelGroup moduleGroup =newDefaultChannelGroup(GlobalEventExecutor.INSTANCE);</span></span>
<span class="line"><span>            moduleGroup.add(channel);</span></span>
<span class="line"><span>            channelGroupMap.put(channelEntity.getModule(), moduleGroup);</span></span>
<span class="line"><span>        } else {</span></span>
<span class="line"><span>            channelGroupMap.get(channelEntity.getModule()).add(channel);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if (channelInfoMap.get(key) ==null) {</span></span>
<span class="line"><span>            channelInfoMap.put(key, channelEntity);</span></span>
<span class="line"><span>        } else {</span></span>
<span class="line"><span>// è¯´æ˜æœ‰æ„æ–™ä¹‹å¤–çš„ç®¡é“ä¿¡æ¯ï¼Œéœ€è¦åˆ‡æ–­æ›¿æ¢ä¸ºæ–°çš„</span></span>
<span class="line"><span>            ChannelGroup channelGroup = channelGroupMap.get(channelEntity.getModule());</span></span>
<span class="line"><span>if (channelGroup !=null) {</span></span>
<span class="line"><span>                Channel ch = channelGroup.find(channelInfoMap.get(key).getChannelId());</span></span>
<span class="line"><span>                channelGroup.disconnect(ChannelMatchers.is(ch));</span></span>
<span class="line"><span>                channelGroup.remove(ch);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            channelInfoMap.put(key, channelEntity);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>return key;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicstaticvoidremoveChannel(ChannelId channelId) {</span></span>
<span class="line"><span>        ChannelEntity channelEntity = channelInfoMap.get(channelId.aslong Text());</span></span>
<span class="line"><span>if (channelEntity ==null) {</span></span>
<span class="line"><span>return;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        channelInfoMap.remove(channelId.aslong Text());</span></span>
<span class="line"><span>        ChannelGroup channelGroup = channelGroupMap.get(channelEntity.getModule());</span></span>
<span class="line"><span>if (channelGroup ==null) {</span></span>
<span class="line"><span>return;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        Channel ch = channelGroup.find(channelId);</span></span>
<span class="line"><span>if (ch ==null) {</span></span>
<span class="line"><span>return;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        channelGroup.disconnect(ChannelMatchers.is(ch));</span></span>
<span class="line"><span>        channelGroup.remove(ch);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicstatic Channel getChannel(String key) {</span></span>
<span class="line"><span>        ChannelEntity channelEntity = channelInfoMap.get(key);</span></span>
<span class="line"><span>if (channelEntity ==null) {</span></span>
<span class="line"><span>returnnull;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        ChannelGroup channelGroup = channelGroupMap.get(channelEntity.getModule());</span></span>
<span class="line"><span>if (channelGroup ==null) {</span></span>
<span class="line"><span>returnnull;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>return channelGroup.find(channelEntity.getChannelId());</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicstatic Channel getChannel(ChannelId channelId) {</span></span>
<span class="line"><span>        AtomicReference&lt;Channel&gt; channel =new AtomicReference&lt;&gt;();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        channelGroupMap.forEach(</span></span>
<span class="line"><span>                (k, group) -&gt; {</span></span>
<span class="line"><span>if (channel.get() ==null&amp;&amp; group.find(channelId) !=null) {</span></span>
<span class="line"><span>                        channel.set(group.find(channelId));</span></span>
<span class="line"><span>                    }</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>        );</span></span>
<span class="line"><span></span></span>
<span class="line"><span>return channel.get();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicstatic ChannelGroup getChannelGroup(String key) {</span></span>
<span class="line"><span>        ChannelEntity channelEntity = channelInfoMap.get(key);</span></span>
<span class="line"><span>if (channelEntity ==null) {</span></span>
<span class="line"><span>returnnull;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>return channelGroupMap.get(channelEntity.getModule());</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicstatic List&lt;ChannelEntity&gt; getChannelByMeta(ChatChannelFun chatChannelFun, List&lt;Map&lt;String, Object&gt;&gt; mapList) {</span></span>
<span class="line"><span>return chatChannelFun.getChannelEntity(channelInfoMap.values(), mapList);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>pangu-frame-chat-server</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    æ¨¡å—ä¸»è¦æ•´ä¸ªnettyæ¨¡å—åŠä¸šåŠ¡æ¨¡å—ï¼Œnettyä¸­çš„wsæ˜¯å®ç°ï¼Œè€Œserveræ¨¡å—åˆ™æ˜¯æ•´åˆè¿™ä¸ªå®ç°ä¸kafkaï¼Œ</span></span>
<span class="line"><span>é€šè¿‡kafkaä¸ä¸šåŠ¡æ²Ÿé€šï¼Œkafka apiä¸wsä¸šåŠ¡æ— å…³ã€‚æ‰€æœ‰è¿™é‡Œå°±ç®—ä»¥åæ•´åˆé¢å¤–çš„é•¿è¿æ¥æ–¹å¼ä¹Ÿæ˜¯æ”¯æŒçš„ã€‚</span></span>
<span class="line"><span>ä¸»è¦ä½œç”¨å°±æ˜¯æ¥æ”¶åç«¯ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œè½¬å‘ï¼Œè€Œå‰ç«¯æ˜¯wsä¸šåŠ¡ï¼Œä¸nettyæ˜¯ä¸€å¯¹çš„ï¼Œæ‰€ä»¥æ“ä½œé›†æˆåœ¨nettyé‡Œè€Œ</span></span>
<span class="line"><span>ä¸æ˜¯åƒåç«¯ä¸€æ ·é›†æˆåœ¨serverç«¯ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>pangu-frame-simple-test</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    è¿™ä»£è¡¨äº†ä¸šåŠ¡æ¨¡å—ï¼Œä¸»è¦é…ç½®çš„æ˜¯ç›‘å¬äº‹ä»¶ï¼Œéœ€è¦å¼•å…¥çš„åŒ…å¦‚ä¸‹</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>xml</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;com.kingtsoft.pangu&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;pangu-frame-chat-api&lt;/artifactId&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>pangu-frame-simple-test</strong>æ‰€å±å¯åŠ¨å™¨åŠ å…¥å¦‚ä¸‹å®ç°</p><p><strong>xml</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;com.kingtsoft.pangu&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;pangu-frame-chat&lt;/artifactId&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>    ç„¶ååªéœ€å®ç°PgChatClientApiæ¥å£ï¼Œå³å¯ç›´æ¥å®ç°æ•°æ®ç›‘å¬å›è°ƒç›‘å¬,ç›‘å¬ä¿¡æ¯æ”¾å…¥</span></span>
<span class="line"><span>åœ¨äº†é…ç½®æ–‡ä»¶å†…ã€‚æ‰€ä»¥å°†ä»£ç ä¸å…·ä½“å®ç°è¿›è¡Œäº†å‰¥ç¦»ã€‚åç»­æ›´æ¢å®ç°è½½ä½“å°†ä¸ä¼šå½±å“å€’ä¸šåŠ¡ä»£ç ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>java</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>package com.kingtsoft.pangu.frame.simple.test.listener;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import com.kingtsoft.pangu.frame.chat.api.PgChatClientApi;</span></span>
<span class="line"><span>import com.kingtsoft.pangu.frame.chat.api.PgChatTemplate;</span></span>
<span class="line"><span>import com.kingtsoft.pangu.frame.chat.common.PgChatEntity;</span></span>
<span class="line"><span>import lombok.extern.slf4j.Slf4j;</span></span>
<span class="line"><span>import org.springframework.stereotype.Component;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import java.util.HashMap;</span></span>
<span class="line"><span>import java.util.List;</span></span>
<span class="line"><span>import java.util.Map;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/**</span></span>
<span class="line"><span> * Title: &lt;br&gt;</span></span>
<span class="line"><span> * Description: &lt;br&gt;</span></span>
<span class="line"><span> * Company: KingTang &lt;br&gt;</span></span>
<span class="line"><span> *</span></span>
<span class="line"><span> * @author é‡‘ç‚€</span></span>
<span class="line"><span> * @version 1.0</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>@Slf4j</span></span>
<span class="line"><span>@Component</span></span>
<span class="line"><span>public class  PgChatClientImplimplementsPgChatClientApi {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private final   PgChatTemplate pgChatTemplate;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>publicPgChatClientImpl(PgChatTemplate pgChatTemplate) {</span></span>
<span class="line"><span>this.pgChatTemplate = pgChatTemplate;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     * ä¸šåŠ¡ç«¯æ¶ˆæ¯ä¿¡æ¯å¤„ç†</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @paramchatList æ¶ˆæ¯</span></span>
<span class="line"><span>     * @author é‡‘ç‚€</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>private void   doChatProcess(List&lt;PgChatEntity&gt; chatList) {</span></span>
<span class="line"><span>for (PgChatEntity pgChatEntity : chatList) {</span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>                System.out.println(pgChatEntity.getContext());</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                Map&lt;String, Object&gt; m =new HashMap&lt;&gt;(4);</span></span>
<span class="line"><span>                m.put(&quot;empId&quot;, 1);</span></span>
<span class="line"><span>                pgChatTemplate.sendChat(&quot;pangu&quot;, &quot;ç¾¤å‘äº†&quot;, 1, m);</span></span>
<span class="line"><span>            } catch (Exception e) {</span></span>
<span class="line"><span>                log.error(&quot;æ—¥å¿—ä¸šåŠ¡ç«¯æ•°æ®å¤„ç†å¤±è´¥ï¼&quot;, e);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>è€Œä¸šåŠ¡ä¸­ä¿¡æ¯å‘é€æ‰€éœ€çš„ä¸ºpgChatTemplateï¼Œç›´æ¥æ³¨å…¥å³å¯ã€‚ä¸Šå›¾ä¸­,æ³¨é‡Šæ‰éƒ¨åˆ†ä¸ºä¿¡æ¯å‘é€ï¼Œä¸»è¦å‚æ•°å¦‚ä¸‹</span></span>
<span class="line"><span>    topicCode           	ä¸ä¹‹å‰å¹³å°ç«¯é…ç½®æ–‡ä»¶ä¸­pangu.kafka.topicsä¸­çš„keyåŒ¹é…</span></span>
<span class="line"><span>    context 			æ¶ˆæ¯ä½“ï¼Œå»ºè®®æ˜¯ä¸šåŠ¡è‡ªå·±ç»Ÿä¸€çš„ç»“æ„ä½“</span></span>
<span class="line"><span>    msgType 		1-è½¬å‘æŒ‡å®šå®¢æˆ·ç«¯ 2-åŒç»„è½¬å‘</span></span>
<span class="line"><span>    Map&lt;String, Object&gt; metaInfo é™„åŠ ä¿¡æ¯ï¼ˆä¸€èˆ¬ç”¨äºè¿‡æ»¤ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦å‘é€empIdä¸º1çš„å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œ</span></span>
<span class="line"><span>åˆ™å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒåŠ å…¥å…¥å‚å³å¯ã€‚é‡Œé¢çš„æ•°æ®åœ¨åˆå§‹åŒ–æ—¶å€™å®¢æˆ·ç«¯ä¼ å…¥å­˜å‚¨å³å¯ï¼‰</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/Todreamr/Dr.Magic/edit/main/src/ç›˜å¤/ç»„ä»¶ä»‹ç»/chatæ¨¡å—.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: aruixrain@gmail.com">ä¹æ­Œå¤©ä¸Šæœ‰</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><!----><a class="route-link auto-link next" href="/%E7%9B%98%E5%8F%A4/%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/%E5%BB%B6%E6%97%B6%E6%A8%A1%E5%9D%97.html" aria-label="Delayæ¨¡å—"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Delayæ¨¡å—<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">ç”±èŒICPå¤‡æ¡ˆ</div><div class="vp-copyright">Copyright Â© Mr.Cotton Eye Joe</div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DGcq1nYR.js" defer></script>
  </body>
</html>
