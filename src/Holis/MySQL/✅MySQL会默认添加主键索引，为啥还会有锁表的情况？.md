# ✅MySQL会默认添加主键索引，为啥还会有锁表的情况？
<!--page header-->

<a name="WdFDl"></a>
# 典型回答

在MySQL中，主键非常重要，因为Innodb中的主键索引是用来构建聚簇索引的。

**如果我们在一张表中没有定义主键，那么，MySQL会默认选择一个唯一的非空索引作为聚簇索引。如果没有适合的非空唯一索引，则会创建一个隐藏的主键（row_id）作为聚簇索引。**

那么也就是说，一个Innodb的表中，是一定会有主键索引的。

那同时，我们也知道，**InnoDB行锁是通过给索引上的索引项加锁来实现的，如果一条记录没有创建索引，那么他会选择锁表。行级锁会升级为表级锁。**

那么问题来了：MySQL不是会默认添加主键索引，为啥还会有锁表的情况呢？

其实，索引，并不只是主键索引，还有很多普通索引呢，我们大多数查询都是基于普通索引的，而数据库在加锁的时候，也会先对普通索引加锁，然后再回表对主键索引加锁。

那么，如果一个update语句的where条件中的字段，用不到普通索引，这时候他就没办法对普通索引加行级锁，那么就需要锁表了。

虽然这张表可能有主键索引，但是在更新这个过程因为不知道要找哪个索引树（因为没普通索引），那么就干脆锁表了。


<!--page footer-->
- 原文: <https://www.yuque.com/hollis666/axzrte/vef33zs32vyylktv>